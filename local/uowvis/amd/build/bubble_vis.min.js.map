{"version":3,"sources":["../src/bubble_vis.js"],"names":["define","md3","d3_slider","log","$","ajax","str","notification","templates","autocomplete","UOWVis","vis_canvas","current_canvas","previous_canvas","x_axis","config","y_axis","x_axis_label","y_axis_label","maxdate","mindate","totalcourses","courseid_to_name_map","date_options","totalwidth","height","totalheight","drawing_div_id","data","tooltip","can_change","gData","searchcourses_label","redrawing","prototype","init","divid","courseids","all_ids","debug","join","promises","call","methodname","args","allcourses","selected","strings","get_strings","component","course_ids","top","right","bottom","left","width","rowheight","min_radius","max_radius","legend_radius","legend_start","legend_width","x_ticks","timelineheight","weekday","year","month","day","when","done","bootstrap_visualisation","bind","fail","exception","redraw","canvas","select","append","style","draw_visualisation","all_courses","nocourse_label","Date","parseInt","forEach","element","courseid","shortname","graphheight","legendheight","moduledata","length","setup_x_axis","setup_y_axis","z_axis","setup_z_axis","color_scale","setup_color_scale","modulenames","setup_tooltip","info","selection_container","classed","draw_course_selection","container","attr","draw_x_axis","ytickFormat","d","draw_y_axis","draw_gridlines","draw_assessment_data","assessment_data","draw_legend","draw_timeline","text","remove","transition","duration","date_axis","domain","sliderTime","sliderHorizontal","min","max","displayFormat","timeFormat","default","fill","on","val","redraw_data","gTime","date_values","min_date","max_date","used_data","filter","date","duedate","axisBottom","ticks","tickSize","tickFormat","axisLeft","scaleTime","range","nice","label","selectAll","scalePoint","padding","axis_data","label_start","scaleLinear","bubble_colours","scaleOrdinal","schemeTableau10","showTooltip","params","course","name","toLocaleDateString","grade_percent","weight","tooltipstring","get_string","tooltipStr","html","event","pageX","pageY","moveTooltip","hideTooltip","highlight","type","noHighlight","x","y","z","modulename","graph_width","enter","i","langstring","context","selected_courses","render","then","module","change","selected_course","enhance","remove_courseid","e","preventDefault","currentTarget","match","value","vis"],"mappings":"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","sourcesContent":["// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for the Assessment workload bubblevis for course assessment dates.\n * this code was heavily informed by the https://www.d3-graph-gallery.com/bubble.html\n * tutorials\n *\n * @package    local_uowvis\n * @author     Francis Devine <francis@catalyst.net.nz>\n * @copyright  2020 Catalyst IT Ltd\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['local_uowvis/d3', 'local_uowvis/d3-simple-slider', 'core/log',\n    'jquery', 'core/ajax', 'core/str', 'core/notification', 'core/templates',\n    'core/form-autocomplete'],\n    function (md3, d3_slider, log, $, ajax, str, notification, templates, autocomplete) {\n        function UOWVis() {\n            // SVG used to draw the graph in.\n            this.vis_canvas = null;\n            // The div we are putting the graph + associated control templates in (starts hidden and is faded in when drawn).\n            this.current_canvas = null;\n            // The div a previous canvas lived in (if one existed), we fade this out, once the redraw is done.\n            this.previous_canvas = null;\n            // D3 scale for the x axis (courses).\n            this.x_axis = null;\n            // Config object with some developer set configs.\n            this.config = null;\n            // D3 scale for y axis(dates).\n            this.y_axis = null;\n            // Holds strings from moodle.\n            this.x_axis_label = null;\n            this.y_axis_label = null;\n            // Max/min date of data sent in.\n            this.maxdate = null;\n            this.mindate = null;\n            // Total courses being processed here.\n            this.totalcourses = null;\n            // Generated map of courseid -> name (used in the x_axis scale to get nice readable names).\n            this.courseid_to_name_map = null;\n            // Options to format the date (all developer set).\n            this.date_options = null;\n            // Total width of the graph including margins.\n            this.totalwidth = null;\n            // Height of graph (rowheight config * num courses).\n            this.height = null;\n            // Total height of graph including margins.\n            this.totalheight = null;\n            // ID of the div we are drawing on.\n            this.drawing_div_id = null;\n            // Last fetched data from webservice.\n            this.data = null;\n            // A div for drawing tooltips.\n            this.tooltip = null;\n            // Can the user select courses for display.\n            this.can_change = null;\n            // The svg G drawing attribute containing the data dots.\n            this.gData = null;\n            // String to encourage users to search in the dropdown box.\n            this.searchcourses_label = null;\n            // We are currently redrawing, don't allow changes to the courses selected.\n            this.redrawing = null;\n        }\n\n        UOWVis.prototype.init = function (divid, courseids, all_ids, can_change) {\n            log.debug('Creating graph at div with id ' + divid + ' for following courses ' + courseids.join(','));\n\n            log.debug('Calling data endpoints');\n            var promises = ajax.call([\n                { methodname: 'local_uowvis_get_visdata', args: { courseids: courseids } },\n                { methodname: 'local_uowvis_get_coursedata', args: { allcourses: all_ids, selected: courseids } }\n            ]);\n            log.debug('Fetching relevant strings');\n            var strings = str.get_strings([\n                { 'key': 'timelabel', component: 'local_uowvis' },\n                { 'key': 'courselabel', component: 'local_uowvis' },\n                { 'key': 'nocourses', component: 'local_uowvis' },\n                { 'key': 'searchcourses', component: 'local_uowvis' },\n            ]);\n            this.can_change = can_change;\n            this.course_ids = courseids;\n            this.all_ids = all_ids;\n            this.drawing_div_id = divid;\n\n            this.config = {\n                // Margin of graph.\n                top: 50, right: 120, bottom: 100, left: 135,\n                width: 900,\n                // Height of a row for each course (should be greater than circle size by a small margin).\n                rowheight: 60,\n                // Radius of largest circle (scaled by assessessment value compared to course overall).\n                min_radius: 2,\n                max_radius: 30,\n                legend_radius: 8,\n                // How far from the \"width\" of the graph the legend starts.\n                legend_start: 40,\n                legend_width: 100,\n                x_ticks: 10,\n                timelineheight: 100,\n            };\n            this.date_options = {\n                weekday: 'long',\n                year: 'numeric',\n                month: 'long',\n                day: 'numeric'\n            };\n            $.when(promises[0], promises[1], strings)\n                .done(this.bootstrap_visualisation.bind(this))\n                .fail(notification.exception);\n\n        };\n\n        UOWVis.prototype.redraw = function () {\n            if(this.redrawing) {\n                log.debug('already redrawing, refusing request');\n                return;\n            }\n            this.redrawing = true;\n            log.debug('Recreating graph at div with id ' + this.drawing_div_id + ' for following courses '\n                + this.course_ids.join(','));\n\n            log.debug('Calling data endpoint');\n            var promises = ajax.call([\n                { methodname: 'local_uowvis_get_visdata', args: { courseids: this.course_ids } },\n                { methodname: 'local_uowvis_get_coursedata', args: { allcourses: this.all_ids, selected: this.course_ids } },\n            ]);\n\n            // The canvas we actually draw on (so we can swap/clear it when redrawing).\n            var canvas = md3.select(\"#\" + this.drawing_div_id).append('div');\n            // Swap out canvas, for the post draw fade in/out.\n            this.previous_canvas = this.current_canvas;\n            this.current_canvas = canvas;\n            this.current_canvas.style('visibility', \"hidden\");\n            this.current_canvas.style('opacity', \"0\");\n\n            $.when(promises[0], promises[1])\n                .done(this.draw_visualisation.bind(this, canvas))\n                .fail(notification.exception);\n        };\n\n        /**\n         * This is used only for the first page init, where strings\n         * are also fetched, if the vis object already exists, just redraw it\n         * @param {webservice data} data\n         * @param {strings we need the first time} strings\n         */\n        UOWVis.prototype.bootstrap_visualisation = function (data, all_courses, strings) {\n            // Get some nice label names.\n            this.x_axis_label = strings[0];\n            this.y_axis_label = strings[1];\n            this.nocourse_label = strings[2];\n            this.searchcourses_label = strings[3];\n            // The canvas we actually draw on (so we can swap/clear it when redrawing).\n            var canvas = md3.select(\"#\" + this.drawing_div_id).append('div');\n            this.current_canvas = canvas;\n            this.draw_visualisation(canvas, data, all_courses);\n        };\n\n        /**\n         * Draw the actual visualisation after being prepared\n         * @param {the data returned from the webservice} data\n         */\n        UOWVis.prototype.draw_visualisation = function (canvas, data, all_courses) {\n            // Store a copy of the data.\n            // Convert unix timestamps to date objects.\n            var maxdate = new Date(data.maxdate * 1000);\n            var mindate = new Date(data.mindate * 1000);\n\n            // Turn string into int.\n            this.totalcourses = parseInt(data.totalcourses);\n\n            this.courseid_to_name_map = {};\n            // Calculate the course id -> name map for this graph.\n            all_courses.forEach(function (element) {\n                this.courseid_to_name_map[element.courseid] = element.shortname;\n            }.bind(this));\n\n            var config = this.config;\n            this.data = data;\n\n            // Calculate total area width including legend.\n            this.totalwidth = config.width + config.left + config.right + config.legend_width;\n\n            // Height of entire graph.\n            var graphheight = ((config.rowheight * this.totalcourses));\n            // Height of the legend for the graph.\n            var legendheight = (data.moduledata.length * ((config.legend_radius * 2) + 10));\n            this.height = graphheight;\n\n            // If the legend is larger, make room for it instead.\n            if (this.height < legendheight) {\n                this.height = legendheight;\n            }\n\n            this.totalheight = this.height + config.top + config.bottom;\n\n            // Build our axes based on the data.\n            this.x_axis = this.setup_x_axis(\n                mindate,\n                maxdate,\n                config.width\n            );\n\n            this.y_axis = this.setup_y_axis(\n                data.courseids,\n                this.height\n            );\n\n            this.z_axis = this.setup_z_axis(\n                config.min_radius,\n                config.max_radius\n            );\n\n            this.color_scale = this.setup_color_scale(data.modulenames);\n\n            this.tooltip = this.setup_tooltip();\n\n            log.info('UoW Bubble Vis drawing graph from response data width:' +\n                this.totalwidth +\n                ' height:' +\n                this.totalheight\n            );\n\n            if (this.can_change) {\n                // Draw the course selection container.\n                var selection_container = canvas\n                    .append(\"div\")\n                    .classed(\"uowvis-selection-container\", true);\n                this.draw_course_selection(\n                    selection_container,\n                    all_courses\n                );\n            }\n\n            if (this.course_ids.length > 0) {\n                var container = canvas\n                    .append(\"div\")\n                    // Container class to make it responsive.\n                    .classed(\"svg-container\", true);\n\n                // Append the svg responsive container to the body of the page.\n                this.vis_canvas = container.append(\"svg\")\n                    // Responsive SVG needs these 2 attributes and no width and height attr.\n                    .attr(\"preserveAspectRatio\", \"xMinYMin meet\")\n                    // Height and width should match child svg content container or it gets clipped.\n                    .attr(\"viewBox\", \"0 0 \" +\n                        this.totalwidth +\n                        \" \" +\n                        this.totalheight\n                    )\n\n                    // Class to make it responsive.\n                    .classed(\"svg-content-responsive\", true)\n                    // Now the content SVG and it's graphics.\n                    .append(\"svg\")\n                    .attr(\"width\", this.totalwidth)\n                    .attr(\"height\", this.totalheight)\n                    .append(\"g\")\n                    .attr(\"transform\",\n                        \"translate(\" + config.left + \",\" + config.top + \")\");\n\n                log.debug(\"Drawing the x_axis\");\n                this.draw_x_axis(\n                    this.vis_canvas,\n                    this.x_axis,\n                    config.width,\n                    this.height,\n                    config.x_ticks,\n                    this.x_axis_label\n                );\n\n                var ytickFormat = function (d) {\n                    return this.courseid_to_name_map[d];\n                }.bind(this);\n\n                log.debug(\"Drawing the y axis\");\n                this.draw_y_axis(\n                    this.vis_canvas,\n                    this.y_axis,\n                    data.courseids,\n                    ytickFormat,\n                    this.y_axis_label,\n                    config.left * -1\n                );\n\n                log.debug(\"Drawing the grid lines\");\n                this.draw_gridlines(\n                    this.vis_canvas,\n                    config.width,\n                    this.height,\n                    this.x_axis,\n                    this.y_axis\n                );\n\n                log.debug(\"Drawing the vis data\");\n                this.gData = this.vis_canvas\n                    .append('g')\n                    .attr(\"class\", \"data\");\n\n                this.draw_assessment_data(\n                    this.gData,\n                    data.assessment_data,\n                    this.x_axis,\n                    this.y_axis,\n                    this.z_axis,\n                    this.color_scale\n                );\n\n                log.debug(\"Drawing legend:\" +\n                    config.legend_start + \" \" +\n                    config.legend_radius + \" \" +\n                    config.width\n                );\n                this.draw_legend(\n                    this.vis_canvas,\n                    data.moduledata,\n                    config.legend_start,\n                    config.legend_radius,\n                    config.width,\n                    this.color_scale\n                );\n\n                log.debug(\"Drawing timeline range\");\n                this.draw_timeline(this.vis_canvas, this.totalheight, config, this.x_axis);\n\n            }\n            else {\n                canvas\n                    .append(\"text\")\n                    .text(this.nocourse_label);\n            }\n            if (this.previous_canvas !== null) {\n                log.debug(\"Clearing old canvas as drawing complete\");\n                this.previous_canvas.remove();\n                this.current_canvas.style('visibility', \"visible\");\n                this.current_canvas.transition()\n                    .duration(400)\n                    .style(\"opacity\", 1);\n                this.previous_canvas.transition()\n                    .duration(400)\n                    .style(\"opacity\", 0)\n                    .remove();\n            }\n            this.redrawing = false;\n        };\n\n        UOWVis.prototype.draw_timeline = function (canvas, totalheight, config, date_axis) {\n            var domain = date_axis.domain();\n            var mindate = domain[0];\n            var maxdate = domain[1];\n\n            var sliderTime = d3_slider\n                .sliderHorizontal()\n                .min(mindate)\n                .max(maxdate)\n                .width(config.width)\n                .displayFormat(md3.timeFormat('%B %d'))\n                .default([mindate, maxdate])\n                .fill('#2196f3')\n                .on('end', function (val) {\n                    this.redraw_data(val);\n                }.bind(this));\n\n            var gTime = canvas\n                .append('g')\n                .attr('transform', 'translate(0,' + (totalheight - config.bottom) + ')');\n\n            gTime.call(sliderTime);\n        };\n\n        /*\n         *  Redraw the data filtering only to the dates provided in the dates value array\n         */\n        UOWVis.prototype.redraw_data = function (date_values) {\n            var min_date = date_values[0];\n            var max_date = date_values[1];\n            var used_data = this.data.assessment_data.filter(function (d) {\n                var date = new Date(d.duedate * 1000);\n                return date > min_date && date < max_date;\n            });\n\n            var x_axis = this.setup_x_axis(min_date, max_date, this.config.width);\n            this.draw_x_axis(\n                this.vis_canvas,\n                x_axis,\n                this.config.width,\n                this.height,\n                this.config.x_ticks,\n                this.x_axis_label\n            );\n            this.draw_assessment_data(\n                this.gData,\n                used_data,\n                x_axis,\n                this.y_axis,\n                this.z_axis,\n                this.color_scale\n            );\n            log.debug(\"Data and X axis redrawn in response to timeline request\");\n        };\n\n        /*\n         * Draws the gridlines into the graph canvas, to help user track the data\n         */\n        UOWVis.prototype.draw_gridlines = function (canvas, width, height, x_axis, y_axis) {\n            canvas.append(\"g\")\n                .attr(\"class\", \"uowvis_grid\")\n                .attr(\"transform\", \"translate(0, \" + height + \")\")\n                .call(\n                    md3.axisBottom(x_axis)\n                        .ticks(5)\n                        .tickSize(-height)\n                        .tickFormat(\"\")\n                );\n            canvas.append(\"g\")\n                .attr(\"class\", \"uowvis_grid\")\n                .call(\n                    md3.axisLeft(y_axis)\n                        .ticks(5)\n                        .tickSize(-width)\n                        .tickFormat(\"\")\n                );\n        };\n\n        UOWVis.prototype.setup_x_axis = function (mindate, maxdate, width) {\n            // Configure X axis (time scale based on assessment due date).\n            var x_axis = md3.scaleTime()\n                .domain([\n                    mindate,\n                    maxdate,\n                ])\n                .range([0, width]).nice();\n            return x_axis;\n        };\n\n        UOWVis.prototype.draw_x_axis = function (canvas, x_axis, width, height, ticks, label) {\n            // Delete if it already exists (for redraw).\n            canvas.selectAll(\".x-axis\").remove();\n            canvas.selectAll(\".x-axis-label\").remove();\n            // Draw X axis.\n            canvas\n                .append(\"g\")\n                .attr(\"class\", \"x-axis\")\n                .attr(\"transform\", \"translate(0,\" + height + \")\")\n                .call(md3.axisBottom(x_axis).ticks(ticks));\n\n            // Add X axis label.\n            canvas\n                .append(\"text\")\n                .attr(\"class\", \"x-axis-label\")\n                .attr(\"text-anchor\", \"end\")\n                .attr(\"x\", width / 2)\n                .attr(\"y\", height + 40)\n                .text(label);\n        };\n\n        UOWVis.prototype.setup_y_axis = function (course_ids, height) {\n            // Set up the Y axis scale (categorical based on course).\n            var y_axis = md3.scalePoint()\n                .domain(course_ids)\n                .range([0, height])\n                .padding(1);\n            return y_axis;\n        };\n\n        UOWVis.prototype.draw_y_axis = function (canvas, y_axis, axis_data, tickFormat, label, label_start) {\n            // Draw Y axis.\n            canvas\n                .append(\"g\")\n                .attr(\"class\", \"y-axis\")\n                .call(\n                    md3.axisLeft(y_axis)\n                        .ticks(axis_data).tickFormat(tickFormat)\n                );\n\n            // Add Y axis label.\n            canvas\n                .append(\"text\")\n                .attr(\"text-anchor\", \"end\")\n                .attr(\"x\", label_start)\n                .attr(\"y\", 3)\n                .text(label)\n                .attr(\"text-anchor\", \"start\");\n        };\n\n        UOWVis.prototype.setup_z_axis = function (min_radius, max_radius) {\n            // Add a scale for bubble size.\n            var z_axis = md3.scaleLinear()\n                .domain([0, 100])\n                .range([min_radius, max_radius]);\n            return z_axis;\n        };\n\n        UOWVis.prototype.setup_color_scale = function (modulenames) {\n            // Add a scale for bubble color.\n            var bubble_colours = md3.scaleOrdinal()\n                .domain(modulenames)\n                .range(md3.schemeTableau10);\n            return bubble_colours;\n        };\n\n        UOWVis.prototype.setup_tooltip = function () {\n            // Add a tooltip div that's used for hovering on the dots.\n            var tooltip = md3.select('body')\n                .append(\"div\")\n                .attr(\"class\", \"tooltip\")\n                .style(\"background-color\", \"black\")\n                .style(\"border-radius\", \"5px\")\n                .style(\"padding\", \"10px\")\n                .style(\"color\", \"white\");\n            return tooltip;\n        };\n\n        // Tooltip control functions.\n        UOWVis.prototype.showTooltip = function (d) {\n            var tooltip = this.tooltip;\n            var config = this.config;\n            // Fetch the tooltip string from moodle, given these parameters.\n            var params = {\n                course: d.course,\n                name: d.name,\n                date: new Date(d.duedate * 1000).toLocaleDateString(undefined, this.date_options),\n                grade_percent: d.weight,\n            };\n            var tooltipstring = str.get_string('tooltip', 'local_uowvis', params);\n            // As soon as the string is retrieved, i.e. the promise has been fulfilled.\n            // Edit the text of a UI element so that it then is the localized string.\n            $.when(tooltipstring).done(function (tooltipStr) {\n                tooltip.html(tooltipStr);\n            }.bind(this));\n\n            tooltip\n                .transition()\n                .duration(100);\n            tooltip\n                .style(\"opacity\", 1)\n                .style(\"left\", (md3.event.pageX + config.max_radius) + \"px\")\n                .style(\"top\", (md3.event.pageY + config.max_radius) + \"px\");\n        };\n\n        UOWVis.prototype.moveTooltip = function () {\n            var tooltip = this.tooltip;\n            var config = this.config;\n            tooltip\n                .style(\"left\", (md3.event.pageX + config.max_radius) + \"px\")\n                .style(\"top\", (md3.event.pageY + config.max_radius) + \"px\");\n        };\n\n        UOWVis.prototype.hideTooltip = function () {\n            this.tooltip\n                .style(\"opacity\", 0)\n                .style(\"left\", \"0px\")\n                .style(\"top\", \"0px\");\n        };\n\n        UOWVis.prototype.highlight = function (d) {\n            // Fade opacity of all bubble groups.\n            md3.selectAll(\"#\" + this.drawing_div_id + \" .bubbles\").style(\"opacity\", .05);\n            // Except the one that is hovered.\n            md3.selectAll(\"#\" + this.drawing_div_id + \" .\" + d.type).style(\"opacity\", 0.8);\n            log.debug(\"Highlighting: \" + d.type);\n        };\n\n        UOWVis.prototype.noHighlight = function () {\n            md3.selectAll(\".bubbles\").style(\"opacity\", 0.8);\n        };\n\n        UOWVis.prototype.draw_assessment_data = function (gData, data, x, y, z, color_scale) {\n            // Add dots according to the data.\n            gData\n                .selectAll(\"circle\")\n                .data(data)\n                .join(\"circle\")\n                .attr(\"cx\", function (d) { return x(new Date(d.duedate * 1000)); })\n                .attr(\"cy\", function (d) { return y(d.courseid); })\n                .attr(\"r\", function (d) { return z(d.weight); })\n                .style(\"fill\", function (d) { return color_scale(d.modulename); })\n                // Class for doing legend.\n                .attr(\"class\", function (d) { return \"bubbles \" + d.modulename; })\n                .style(\"opacity\", \"0.8\")\n                .attr(\"stroke\", \"black\")\n                // Add our tooltip controls.\n                .on(\"mouseover\", this.showTooltip.bind(this))\n                .on(\"mousemove\", this.moveTooltip.bind(this))\n                .on(\"mouseleave\", this.hideTooltip.bind(this));\n        };\n\n        UOWVis.prototype.draw_legend = function (canvas, data, legend_start, legend_radius, graph_width, color_scale) {\n            // Draw the legend groups.\n            canvas\n                .selectAll(\"myrect\")\n                .data(data)\n                .enter()\n                .append(\"circle\")\n                .attr(\"cx\", graph_width + legend_start)\n                .attr(\"cy\", function (d, i) { return i * ((legend_radius * 2) + 10); })\n                .attr(\"r\", legend_radius)\n                .attr(\"id\", function (d) { return d.type; })\n                .style(\"fill\", function (d) { return color_scale(d.type); })\n                .on(\"mouseover\", this.highlight.bind(this))\n                .on(\"mouseleave\", this.noHighlight.bind(this));\n\n            // Add labels beside legend dots.\n            canvas\n                .selectAll(\"mylabels\")\n                .data(data)\n                .enter()\n                .append(\"text\")\n                .attr(\"x\", graph_width + legend_start + (legend_radius * 2))\n                .attr(\"y\", function (d, i) { return (i * ((legend_radius * 2) + 10) + (legend_radius / 2)); })\n                .style(\"fill\", function (d) { return color_scale(d.type); })\n                .text(function (d) { return d.langstring; })\n                .attr(\"id\", function (d) { return d.type; })\n                .attr(\"text-anchor\", \"left\")\n                .style(\"alignment-baseline\", \"middle\")\n                .on(\"mouseover\", this.highlight.bind(this))\n                .on(\"mouseleave\", this.noHighlight.bind(this));\n        };\n\n        UOWVis.prototype.draw_course_selection = function (container, all_courses) {\n            var context = new Object;\n            context.selected_courses = Array();\n            context.divid = this.drawing_div_id;\n            context.all_courses = all_courses;\n            templates.render('local_uowvis/selection_panel', context)\n                .then(function (module, html) {\n                    container.html(html);\n                    $('#uowvis-course-select-' + module.drawing_div_id).change(module.selected_course.bind(module));\n                    // Juice selection box to be a super autocompleter.\n                    autocomplete.enhance('#uowvis-course-select-' + module.drawing_div_id, false,\n                        'local_uowvis/bubble_vis_datasource',\n                        module.searchcourses_label, false, true, '');\n                }.bind(null, this)).fail(notification.exception);\n        };\n\n        UOWVis.prototype.remove_courseid = function (e) {\n            e.preventDefault();\n            if(this.redrawing) {\n                log.debug(\"Redrawing, refusing to update courses\");\n                return;\n            }\n            var courseid = $(e.currentTarget).data('courseid');\n            log.debug('Deletion click event on graph at' + this.drawing_div_id);\n\n            this.course_ids = this.course_ids.filter(function (match, value) {\n                return match != value;\n            }.bind(null, courseid));\n            this.redraw();\n        };\n\n        UOWVis.prototype.selected_course = function (e) {\n            e.preventDefault();\n            if(this.redrawing) {\n                log.debug(\"Redrawing, refusing to update courses\");\n                return;\n            }\n            var courseids = $(e.currentTarget).val();\n            this.course_ids = courseids;\n            this.all_ids = courseids;\n            this.redraw();\n        };\n\n        // Now create the wrapper for the AMD module.\n        var visualisation = {\n            init: function (divid, courseids, all_ids, can_change) {\n                var vis = new UOWVis();\n                vis.init(divid, courseids, all_ids, can_change);\n            }\n\n        };\n        return /** @alias module:local_uowvis/this */ {\n            /**\n             * Initialise the visualisation for the current page\n             *\n             * @method  init\n             */\n            init: visualisation.init,\n        };\n    });\n"],"file":"bubble_vis.min.js"}