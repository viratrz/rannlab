{"version":3,"sources":["efb_form_basic_settings.js"],"names":["define","$","document","ready","addEmail","index","email","classes","emailElement","createElement","html","attr","Math","floor","random","length","deleteEmail","append","insertBefore","children","changeToEmailTag","edit","editing","data","test","emails","indexOf","validateEditEmail","val","showEmailError","M","util","get_string","remove","join","hideEmailError","getBodyTags","string","tags","container","each","tag","info","parent","prepend","hide","after","id","click","this","on","next","toggleClass","text","hasClass","parents","siblings","trim","show","addClass","removeClass","checkAndAdd","elem","validateEmail","nextIndex","push","split","splice","focus","changeToEmailEdit","event","keyCode","slice","preventDefault"],"mappings":"AAAA,aAwBAA,OAAO,CAAC,UAAW,SAAUC,GAC3BA,EAAEC,UAAUC,MAAM,WAiDhB,SAASC,EAASC,EAAOC,GACvB,IAAIC,EAAU,CAAC,UAAW,UAAW,UAAW,QAC5CC,EAAeN,SAASO,cAAc,QAC1CR,EAAEO,GAAcE,KAAKJ,GACrBL,EAAEO,GAAcG,KAAK,aAAcL,GACnCL,EAAEO,GAAcG,KAAK,QAAS,qBAAuBJ,EAAQK,KAAKC,MAAMD,KAAKE,SAAWP,EAAQQ,UAChG,IAAIC,EAAcd,SAASO,cAAc,QACzCR,EAAEe,GAAaL,KAAK,QAAS,oBAC7BV,EAAEe,GAAaN,KAAK,KACpBT,EAAEO,GAAcS,OAAOhB,EAAEe,IACzBf,EAAEO,GAAcU,aAAajB,EAAE,uBAAuBkB,WAAWd,IA0BnE,SAASe,EAAiBC,GACxB,IAAgB,GAAZC,EAAe,CACjB,IAAIjB,EAAQJ,EAAEoB,GAAME,KAAK,SAGzB,OA9DJ,SAA2BlB,EAAOC,GAIhC,MAFa,uGAEFkB,KAAKlB,IACgB,GAA1BmB,EAAOC,QAAQpB,IAAgBmB,EAAOC,QAAQpB,IAAUD,EACnD,EAGF,EAGF,EAgDQsB,CAAkBtB,EAAOJ,EAAEoB,GAAMO,QAG5C,KAAK,EAEH,YADAC,EAAeC,EAAEC,KAAKC,WAAW,+BAAgC,sBAGnE,KAAK,EACHV,GAAW,EACX,IAAIhB,EAAQL,EAAEoB,GAAMO,MAMpB,OALA3B,EAAEoB,GAAMY,SACR7B,EAASC,EAAOC,GAChBmB,EAAOpB,GAASC,EAChBL,EAAE,oBAAoB2B,IAAIH,EAAOS,KAAK,WACtCC,IAGF,KAAK,EAEH,YADAN,EAAeC,EAAEC,KAAKC,WAAW,iCAAkC,wBAiC3E,SAASI,EAAYC,GACnB,IAAIC,EAAOR,EAAEC,KAAKC,WAAWK,EAAQ,qBACjCE,EAAY,wCAKhB,OAJAtC,EAAEuC,KAAKF,EAAM,SAAUG,EAAKC,GAC1BH,GAAa,gDAAkDG,EAAO,KAAOD,EAAM,cAErFF,GAAa,cAjCftC,EAAE,oBAAoB0C,SAASC,QAAQ,yIAAgJd,EAAEC,KAAKC,WAAW,2BAA4B,qBAAuB,gBAC5P/B,EAAE,oBAAoB4C,OAEtB5C,EAAE,yBAAyB6C,MAAMhB,EAAEC,KAAKC,WAAW,mBAAoB,oBAAqB,CAC1Fe,GAAI,gCACJV,OAAQ,2BAGVpC,EAAE,wBAAwB6C,MAAMhB,EAAEC,KAAKC,WAAW,mBAAoB,oBAAqB,CACzFe,GAAI,+BACJV,OAAQ,kCAGVpC,EAAE,uBAAuB6C,MAAMhB,EAAEC,KAAKC,WAAW,6BAA8B,oBAAqB,CAClGe,GAAI,8BACJV,OAAQ,2BAGVpC,EAAE,gBAAgB+C,MAAM,WACtB/C,EAAEA,EAAEgD,MAAM1B,KAAK,OAAOb,KAAKoB,EAAEC,KAAKC,WAAW/B,EAAEgD,MAAM1B,KAAK,UAAW,wBAkBvEtB,EAAE,QAAQiD,GAAG,QAAS,yBAA0B,WAC9CjD,EAAEgD,MAAME,OAAOC,YAAY,QAC3BnD,EAAEgD,MAAMI,KAAKpD,EAAEgD,MAAME,OAAOG,SAAS,QAAUxB,EAAEC,KAAKC,WAAW,sBAAuB,qBAAuBF,EAAEC,KAAKC,WAAW,sBAAuB,wBAG1J/B,EAAE,yBAAyBsD,QAAQ,aAAaC,WAAWvC,OAAO,gDAAkDa,EAAEC,KAAKC,WAAW,sBAAuB,qBAAuB,OAASI,EAAY,uBAAyB,UAElOnC,EAAE,wBAAwBsD,QAAQ,aAAaC,WAAWvC,OAAO,gDAAkDa,EAAEC,KAAKC,WAAW,sBAAuB,qBAAuB,OAASI,EAAY,uBAAyB,UAEjOnC,EAAE,uBAAuBsD,QAAQ,aAAaC,WAAWvC,OAAO,gDAAkDa,EAAEC,KAAKC,WAAW,sBAAuB,qBAAuB,OAASI,EAAY,wBAA0B,UACjO,IAAIX,EAASxB,EAAE,oBAAoB2B,MAAM6B,OACrCnC,GAAW,EAkCf,SAASO,EAAeQ,GACtBpC,EAAE,0BAA0BS,KAAK2B,GACjCpC,EAAE,0BAA0ByD,OAC5BzD,EAAE,0BAA0B0C,OAAO,aAAagB,SAAS,cAO3D,SAASxB,IACPlC,EAAE,0BAA0B4C,OAAOF,OAAO,aAAaiB,YAAY,cACnE3D,EAAE,oBAAoB2B,IAAIH,EAAOS,KAAK,MAQxC,SAAS2B,EAAYC,GACnB,GAAqB,IAAjB7D,EAAE6D,GAAMlC,MAOZ,OAxNF,SAAuBtB,GAIrB,MAFa,uGAEFkB,KAAKlB,IACgB,GAA1BmB,EAAOC,QAAQpB,GACV,EAGF,EAGF,EA0MMyD,CAAc9D,EAAE6D,GAAMlC,QAGjC,KAAK,EAEH,YADAC,EAAeC,EAAEC,KAAKC,WAAW,+BAAgC,sBAGnE,KAAK,EACH,IAAIgC,EAAY/D,EAAE6D,GAAMN,SAAS,cAAczC,OAC3CT,EAAQL,EAAE6D,GAAMlC,MAAM6B,OAK1B,OAJArD,EAAS4D,EAAW1D,GACpBmB,EAAOwC,KAAK3D,GACZL,EAAE6D,GAAMlC,IAAI,SACZO,IAGF,KAAK,EAEH,YADAN,EAAeC,EAAEC,KAAKC,WAAW,iCAAkC,2BArBrEG,IArDFV,EADEA,EAAOV,OAAS,EACTU,EAAOyC,MAAM,KAEb,GAGXjE,EAAEuC,KAAKf,EAAQ,SAAUpB,EAAOC,GAC9BF,EAASC,EAAOC,KAElBL,EAAE,QAAQiD,GAAG,QAAS,oBAAqB,WACzC,IAAI5C,EAAQL,EAAEgD,MAAMN,SAChBtC,EAAQJ,EAAE,cAAcI,MAAMC,GAClCmB,EAAO0C,OAAO9D,EAAO,GACrBC,EAAM2B,SACNhC,EAAE,oBAAoB2B,IAAIH,EAAOS,KAAK,QAExCjC,EAAE,QAAQiD,GAAG,WAAY,aAAc,YA/GvC,SAA2BT,GACzB,IAAInC,EAAQL,EAAEwC,GAAKlB,KAAK,SACpBlB,EAAQJ,EAAE,cAAcI,MAAMoC,GAClCnB,EAAUjB,EACV,IAAIG,EAAeN,SAASO,cAAc,SAC1CR,EAAEwC,GAAKR,SACPhC,EAAEO,GAAcoB,IAAItB,GACpBL,EAAEO,GAAcG,KAAK,QAAS,2BAC9BV,EAAEO,GAAcG,KAAK,aAAcN,GACnCJ,EAAEO,GAAcU,aAAajB,EAAE,uBAAuBkB,WAAWd,IACjEJ,EAAEO,GAAc4D,QAsGhBC,CAAkBpE,EAAEgD,SAEtBhD,EAAE,QAAQiD,GAAG,WAAY,2BAA4B,WACnD9B,EAAiBnB,EAAEgD,SAErBhD,EAAE,QAAQiD,GAAG,QAAS,2BAA4B,SAAUoB,GACrC,IAAjBA,EAAMC,SAAkC,IAAjBD,EAAMC,SAC/BnD,EAAiBnB,EAAEgD,SAwDvBhD,EAAE,QAAQiD,GAAG,QAAS,4BAA6B,SAAUoB,GACtC,IAAjBA,EAAMC,SAAkC,IAAjBD,EAAMC,QAE/BV,EAAYZ,MACc,KAAjBqB,EAAMC,UAEftE,EAAEgD,MAAMrB,IAAI3B,EAAEgD,MAAMrB,MAAM4C,MAAM,GAAI,IACpCX,EAAYZ,SAGhBhD,EAAE,QAAQiD,GAAG,WAAY,4BAA6B,SAAUoB,GAC9DA,EAAMG,iBACNZ,EAAYZ","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Edwiser Form basic settings js\n * @package   local_edwiserform\n * @copyright (c) 2020 WisdmLabs (https://wisdmlabs.com/) <support@wisdmlabs.com>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author    Yogesh Shirsath\n */\ndefine(['jquery'], function($) {\n    $(document).ready(function() {\n\n        /**\n         * Validate email address\n         * @param {String} email Email address\n         * @return {Integer}\n         */\n        function validateEmail(email) {\n            // eslint-disable-next-line no-useless-escape\n            var filter = /^([\\w-\\.]+)@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.)|(([\\w-]+\\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\\]?)$/;\n            if (filter.test(email)) {\n                if (emails.indexOf(email) != -1) {\n                    return 2;\n                }\n                return 1;\n            }\n            return 0;\n\n        }\n\n        /**\n         * Validate editing email\n         * @param {Integer} index Email index\n         * @param {Email} email Email id\n         * @return {Integer}\n         */\n        function validateEditEmail(index, email) {\n            // eslint-disable-next-line no-useless-escape\n            var filter = /^([\\w-\\.]+)@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.)|(([\\w-]+\\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\\]?)$/;\n            if (filter.test(email)) {\n                if (emails.indexOf(email) != -1 && emails.indexOf(email) != index) {\n                    return 2;\n                }\n                return 1;\n            }\n            return 0;\n\n        }\n\n        /**\n         * Add email in email list\n         * @param {Integer} index Email index\n         * @param {String}  email Email id\n         */\n        function addEmail(index, email) {\n            var classes = [\n                'primary',\n                'warning',\n                'success',\n                'info',\n            ];\n            var emailElement = document.createElement(\"span\");\n            $(emailElement).html(email);\n            $(emailElement).attr(\"data-email\", email);\n            $(emailElement).attr(\"class\", 'email-tag btn btn-' + classes[Math.floor((Math.random() * classes.length))]);\n            var deleteEmail = document.createElement(\"span\");\n            $(deleteEmail).attr(\"class\", \"email-tag-delete\");\n            $(deleteEmail).html(\"X\");\n            $(emailElement).append($(deleteEmail));\n            $(emailElement).insertBefore($(\".notifi-email-group\").children()[index]);\n        }\n\n        /**\n         * Change email tag to email edit element\n         * @param {DOM} tag Email tag element\n         */\n        function changeToEmailEdit(tag) {\n            let email = $(tag).data('email');\n            let index = $(\".email-tag\").index(tag);\n            editing = index;\n            var emailElement = document.createElement(\"input\");\n            $(tag).remove();\n            $(emailElement).val(email);\n            $(emailElement).attr(\"class\", \"notifi-email-group-edit\");\n            $(emailElement).attr(\"data-index\", index);\n            $(emailElement).insertBefore($(\".notifi-email-group\").children()[index]);\n            $(emailElement).focus();\n        }\n\n        /**\n         * Change email edit element to email tag\n         * @param {DOM} edit Email edit element\n         */\n        function changeToEmailTag(edit) {\n            if (editing != -1) {\n                var index = $(edit).data('index');\n                var status = validateEditEmail(index, $(edit).val());\n                switch (status) {\n                    case 0:\n                        showEmailError(M.util.get_string(\"efb-lbl-notifi-email-warning\", \"local_edwiserform\"));\n                        return;\n                    case 1:\n                        editing = -1;\n                        var email = $(edit).val();\n                        $(edit).remove();\n                        addEmail(index, email);\n                        emails[index] = email;\n                        $(\"#id_notifi_email\").val(emails.join(','));\n                        hideEmailError();\n                        return;\n                    case 2:\n                        showEmailError(M.util.get_string(\"efb-lbl-notifi-email-duplicate\", \"local_edwiserform\"));\n                        return;\n                }\n            }\n        }\n        $(\"#id_notifi_email\").parent().prepend('<div class=\"notifi-email-group\">' +\n        '<input type=\"email\" class=\"notifi-email-group-input form-control\" id=\"notifi-email-group-input\"/><div>' +\n        M.util.get_string('efb-recipient-email-desc', 'local_edwiserform') + '</div></div>');\n        $(\"#id_notifi_email\").hide();\n\n        // Append restore link to email body.\n        $('#id_notifi_email_body').after(M.util.get_string('efb-restore-desc', 'local_edwiserform', {\n            id: '#id_notifi_email_bodyeditable',\n            string: 'efb-notify-email-body'\n        }));\n\n        // Append restore link to confirmation message.\n        $('#id_confirmation_msg').after(M.util.get_string('efb-restore-desc', 'local_edwiserform', {\n            id: '#id_confirmation_msgeditable',\n            string: 'efb-confirmation-default-msg'\n        }));\n\n        // Append restore link to success message.\n        $('#id_success_message').after(M.util.get_string('submission-successful-desc', 'local_edwiserform', {\n            id: '#id_success_messageeditable',\n            string: 'submission-successful'\n        }));\n\n        // Restore content of editor.\n        $('.efb-restore').click(function() {\n            $($(this).data('id')).html(M.util.get_string($(this).data('string'), 'local_edwiserform'));\n        });\n\n        /**\n         * Get email body tags.\n         * @param  {String} string Lang string id\n         * @return {String}        return email body tag.\n         */\n        function getBodyTags(string) {\n            var tags = M.util.get_string(string, 'local_edwiserform');\n            var container = \"<div class='efb-email-tags show'><ul>\";\n            $.each(tags, function(tag, info) {\n                container += '<li><a href=\"#\" class=\"efb-email-tag\" title=\"' + info + '\">' + tag + '</a></li>';\n            });\n            container += \"</ul></div>\";\n            return container;\n        }\n        $('body').on('click', '.efb-email-show-tags>a', function() {\n            $(this).next().toggleClass('show');\n            $(this).text($(this).next().hasClass('show') ?\n            M.util.get_string('efb-email-hide-tags', 'local_edwiserform') :\n            M.util.get_string('efb-email-show-tags', 'local_edwiserform'));\n        });\n\n        // Email tags for email body.\n        $(\"#id_notifi_email_body\").parents('.felement').siblings().\n        append('<div class=\"efb-email-show-tags\"><a href=\"#\">' +\n        M.util.get_string('efb-email-hide-tags', 'local_edwiserform') + '</a>' + getBodyTags('efb-email-body-tags') + '</div>');\n\n        // Email tags for confirmation message.\n        $(\"#id_confirmation_msg\").parents('.felement').siblings().\n        append('<div class=\"efb-email-show-tags\"><a href=\"#\">' +\n        M.util.get_string('efb-email-hide-tags', 'local_edwiserform') + '</a>' + getBodyTags('efb-email-body-tags') + '</div>');\n\n        // Tags for success message.\n        $(\"#id_success_message\").parents('.felement').siblings().\n        append('<div class=\"efb-email-show-tags\"><a href=\"#\">' +\n        M.util.get_string('efb-email-hide-tags', 'local_edwiserform') + '</a>' + getBodyTags('success_message-tags') + '</div>');\n\n        var emails = $(\"#id_notifi_email\").val().trim();\n        var editing = -1;\n        if (emails.length > 0) {\n            emails = emails.split(\",\");\n        } else {\n            emails = [];\n        }\n        $.each(emails, function(index, email) {\n            addEmail(index, email);\n        });\n\n        $(\"body\").on(\"click\", \".email-tag-delete\", function() {\n            var email = $(this).parent();\n            var index = $(\".email-tag\").index(email);\n            emails.splice(index, 1);\n            email.remove();\n            $(\"#id_notifi_email\").val(emails.join(','));\n        });\n\n        $(\"body\").on(\"dblclick\", \".email-tag\", function() {\n            changeToEmailEdit($(this));\n        });\n\n        $(\"body\").on(\"focusout\", \".notifi-email-group-edit\", function() {\n            changeToEmailTag($(this));\n        });\n\n        $(\"body\").on(\"keyup\", \".notifi-email-group-edit\", function(event) {\n            if (event.keyCode == 13 || event.keyCode == 27) {\n                changeToEmailTag($(this));\n            }\n        });\n\n        /**\n         * Show email validation error.\n         * @param {String} string Error string\n         */\n        function showEmailError(string) {\n            $(\"#id_error_notifi_email\").html(string);\n            $(\"#id_error_notifi_email\").show();\n            $(\"#id_error_notifi_email\").parent(\".felement\").addClass('has-danger');\n        }\n\n        /**\n         * Hide email validation error.\n         */\n        function hideEmailError() {\n            $(\"#id_error_notifi_email\").hide().parent(\".felement\").removeClass('has-danger');\n            $(\"#id_notifi_email\").val(emails.join(','));\n        }\n\n        /**\n         * Check and add email in the list.\n         * @param {DOM} elem Email input element\n         */\n        function checkAndAdd(elem) {\n            if ($(elem).val() == '') {\n                hideEmailError();\n                return;\n            }\n            var status = validateEmail($(elem).val());\n            switch (status) {\n                case 0:\n                    showEmailError(M.util.get_string(\"efb-lbl-notifi-email-warning\", \"local_edwiserform\"));\n                    return;\n                case 1:\n                    var nextIndex = $(elem).siblings('.email-tag').length;\n                    var email = $(elem).val().trim();\n                    addEmail(nextIndex, email);\n                    emails.push(email);\n                    $(elem).val('');\n                    hideEmailError();\n                    return;\n                case 2:\n                    showEmailError(M.util.get_string(\"efb-lbl-notifi-email-duplicate\", \"local_edwiserform\"));\n                    return;\n            }\n        }\n\n        $(\"body\").on(\"keyup\", \"#notifi-email-group-input\", function(event) {\n            if (event.keyCode == 13 || event.keyCode == 32) { // Enter key or space key.\n                checkAndAdd(this);\n            } else if (event.keyCode == 188) { // Comma key.\n                $(this).val($(this).val().slice(0, -1));\n                checkAndAdd(this);\n            }\n        });\n\n        $(\"body\").on(\"focusout\", \"#notifi-email-group-input\", function(event) {\n            event.preventDefault();\n            checkAndAdd(this);\n        });\n    });\n});\n"],"file":"efb_form_basic_settings.min.js"}