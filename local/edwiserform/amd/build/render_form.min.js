"use strict";define(["jquery","core/ajax","core/notification","local_edwiserform/form_styles","local_edwiserform/iefixes","local_edwiserform/formviewer"],function(e,t,i,n){var a={CONTAINER:".edwiserform-container",FULLPAGE:"#edwiserform-fullpage",UPLOADED_FILE:"efb-uploaded-file",DELETE_FILE:"efb-delete-user-file",DELETE_CANCEL:"efb-delete-user-file-cancel",FILE:'input[type="file"]',COMPONENT:"local_edwiserform"},r={DATA_DELETING:"data-deleting",DATA_PROCESSING:"data-processing"},o={container:"",countries:"undefined"==typeof countries?null:countries,localStorage:!1},s=[],l=e(a.CONTAINER),c=e(a.FULLPAGE)&&e(a.FULLPAGE).val(),f={GET_FORM_DEFINITION:function(e){return t.call([{methodname:"edwiserform_get_form_definition",args:{form_id:e,countries:void 0===window.countries||!0}}])[0]},SUBMIT_FORM_DATA:function(e,i){return t.call([{methodname:"edwiserform_submit_form_data",args:{formid:e,data:i}}])[0]},UPLOAD_FILE:function(t){var i=new FormData;return i.append("sesskey",M.cfg.sesskey),i.append(0,t),e.ajax({url:M.cfg.wwwroot+"/local/edwiserform/upload.php",type:"POST",data:i,cache:!1,async:!1,dataType:"json",processData:!1,contentType:!1})}};function u(t,i,n,a,r,o,s){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;e(n).text(r),f.SUBMIT_FORM_DATA(o,s).done(function(r){if(r.status){if(void 0!==r.data&&""!=r.data){var o=JSON.parse(r.data);if("redirect"==o.action)return void(window.location.href=o.url);if("confirmredirect"==o.action)return void(""!=r.msg?i.dom.alert("warning",r.msg,function(){window.location.href=o.url}):window.location.href=o.url)}e(t).html(r.msg),i.dom.alert("success",r.msg),null!==l&&l(t,s),e("#edwiser-activity")&&1==e("#edwiser-activity").val()&&e("body").trigger({type:"formSubmitted",cmid:e("#cmid").val()})}else""!=r.msg&&i.dom.alert("warning",r.msg),r.hasOwnProperty("errors")&&function(t,i){i=JSON.parse(i),e(".custom-validation-error").remove(),e.each(i,function(i,n){var a=e(t).find("#"+i+"-error");0==a.length&&(e(t).find('[name="'+i+'"]').after('<span id="'+i+'-error" class="text-error custom-validation-error"></span>'),a=e(t).find("#"+i+"-error")),a.text(n)})}(t,r.errors);i.dom.loadingClose(),e(n).text(a)}).fail(function(){e(n).text(a),i.dom.loadingClose(),e(n).text(a)})}function d(t,i,n){var o=e(t).closest("form"),s=t,l=i.dom.checkValidity(o[0]),c=e(t).text(),d=e(t).attr(r.DATA_PROCESSING),m=e(o).parent().find(".id").val();if(l){if(""!=e(o).attr("action"))return e(o).submit(),!0;n.preventDefault(),i.dom.loading(),setTimeout(function(){var t=o.serializeArray();t=function(e){var t=["g-recaptcha-response"],i=[];return e.forEach(function(e,n){-1==t.indexOf(e.name)&&i.push(e)}),JSON.stringify(i)}(t=function(t,i){var n=e(t).find(a.FILE);return e.each(n,function(t,n){0!=n.files.length?f.UPLOAD_FILE(n.files[0]).done(function(t){1==t.status&&i.push({name:e(n).attr("name"),type:"file",value:t.itemid})}).fail(function(e){console.log(e)}):"true"==e(n).attr(r.DATA_DELETING)?i.push({name:e(n).attr("name"),type:"file",value:0,delete:!0}):i.push({name:e(n).attr("name"),type:"file",value:0})}),i}(o,t)),u(o,i,s,c,d,m,t)},1e3)}return!1}function m(t){o.sitekey=t,e.each(l,function(t,r){var l=e(r).parent().find(".id").val();f.GET_FORM_DEFINITION(l).done(function(i){0!=i.status?(void 0!==window.countries&&0!=window.countries||void 0===i.countries||0==i.countries||(window.countries=JSON.parse(i.countries),o.countries=countries),o.container=r,s[t]=new Formeo(o,i.definition),s[t].render(r),e(r).prepend("<h2 class='form-header'>"+i.title+"</h2>"),i.data&&function(t,i){var n,r=JSON.parse(i);e.each(r,function(i,r){e.each(e(t).find('[name="'+r.name+'"]'),function(t,i){switch(i.tagName){case"INPUT":switch(i.type){case"radio":i.value==r.value&&e(i).prop("checked",!0),n=new CustomEvent("click",{target:e(i)[0]}),e(i)[0].dispatchEvent(n);break;case"checkbox":i.value==r.value&&e(i).prop("checked",!0);break;case"file":0!=r.value&&(e(i).after('<span class="efb-delete-user-file-notice">'+M.util.get_string("delete-userfile-on-save-notice",a.COMPONENT)+"</span>"),e(i).after('<a href="#" class="'+a.DELETE_CANCEL+'">'+M.util.get_string("cancel-delete-userfile",a.COMPONENT)+"</a>"),e(i).after('<a href="#"  class="'+a.DELETE_FILE+'">'+M.util.get_string("efb-form-action-delete-title",a.COMPONENT)+"</a>"),e(i).after('<a class="'+a.UPLOADED_FILE+'" target="_blank" href="'+r.value+'">'+r.filename+"</a>"));break;default:e(i).val(r.value)}break;case"SELECT":if(e(i).is('[multiple="true"]')){var o=e(i).val();o.push(r.value),r.value=o}e(i).val(r.value);break;case"TEXTAREA":e(i).val(r.value)}n=new CustomEvent("change",{target:e(i)[0]}),e(i)[0].dispatchEvent(n),""!=e(i).val()&&e(i).parents(".f-field-group").addClass("active")})})}(r,i.data),n.apply(e(r).find(".formeo-render"),"add",i.style),i.action&&""!=i.action&&function(t,i){e(t).attr("action",i)}(r,i.action),e(r).submit(function(e){return d(this,s[t],e)}).find("#submit-form").click(function(){return d(this,s[t],event)})):e(r).html(i.msg).addClass("empty")}).fail(i.exception)})}return{init:function(t){e(document).ready(function(){0!=e("#edwiserform-fullpage").length&&1==e("#edwiserform-fullpage").val()&&e("body").addClass("edwiserform-fullpage"),m(t),e(window).resize(function(){e.each(l,function(e){void 0!==s[e]&&s[e].dom.manageFormWidth(c)})}),e(".step-navigation #previous-step, .step-navigation #next-step").click(function(){}),e("body").on("click","."+a.DELETE_FILE,function(t){t.preventDefault(),e(this).siblings(a.FILE).attr(r.DATA_DELETING,!0)}).on("click","."+a.DELETE_CANCEL,function(t){t.preventDefault(),e(this).siblings(a.FILE).attr(r.DATA_DELETING,!1)}).on("change",a.FILE,function(){var t=this;if(0!=e(this)[0].files.length&&e(this).next().hasClass(a.UPLOADED_FILE)){var i=e.inArray(e(t).parents(a.CONTAINER)[0],e(a.CONTAINER));s[i].dom.multiActions("warning",M.util.get_string("attention",a.COMPONENT),M.util.get_string("user-file-replace",a.COMPONENT,e(this).find("h4").text()),[{title:M.util.get_string("proceed",a.COMPONENT),type:"warning"},{title:M.util.get_string("cancel",a.COMPONENT),type:"primary",action:function(){e(t).val("")}}])}}).on("click",".efb-view-fullpage",function(){var t=e(this).closest(a.CONTAINER).parent().find('input[class="id"]').val();window.open(M.cfg.wwwroot+"/local/edwiserform/form.php?id="+t),e(this).closest(a.CONTAINER).html(M.util.get_string("fullpage-link-clicked",a.COMPONENT))})})}}});
//# sourceMappingURL=render_form.min.js.map
