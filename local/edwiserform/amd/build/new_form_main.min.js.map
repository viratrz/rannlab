{"version":3,"sources":["new_form_main.js"],"names":["define","$","ajax","Templates","formStyles","formeo","SELECTORS","FORMTYPE","COMPONENT","EVENT","EVENT_LIST","FORM_STYLE","RENDER_FORM","PANEL","TEMPLATE_OVERLAY","TITLE","ACTIVE","FORM_TITLE","TEMPLATES_ROOT","CONSTANTS","container","document","querySelector","renderContainer","saved","fastselect","formeoOpts","countries","license","svgSprite","M","cfg","wwwroot","localStorage","eventsLoaded","createEvent","initEvent","window","eventlist","PROMISES","GET_TEMPLATE","type","call","methodname","args","name","GET_EVENT_SETTINGS","event","id","CREATE_NEW_FORM","settings","formdef","setting","toString","UPDATE_FORM","TEMPLATES","SETTINGS_CONTAINER","obj","render","resetForm","dom","loading","formtype","val","done","response","loadingClose","status","Formeo","definition","forEach","hasOwnProperty","hasRequiredFields","addEventRequiredFields","fail","ex","alert","message","resetable","fastselectCustomCallbacks","removeSelectedOption","option","$choiceItem","value","removedModel","this","optionsCollection","removeSelected","$item","removeClass","options","itemSelectedClass","remove","$el","find","selectorFromClass","choiceItemClass","updateDomElements","writeToInput","toaster","util","get_string","html","setSelectedOption","isSelected","setSelected","selectedModel","findWhere","model","isMultiple","$controls","addChoiceItem","fastsearch","$resultItems","$toggleBtn","text","addClass","pluginhassetting","plugin","getEventSettings","js","appendNodeContents","init","location","reload","emptyFormDefinition","JSON","parse","getFormDef","Object","keys","fields","length","canSeePreview","emptyform","toggleClass","formData","canSaveForm","checkTemplate","checkTitle","parents","promise","console","log","switchPanel","showError","undefined","getFormSettings","active","attr","emptytitle","title","field","attrs","required","hasFieldWithName","template","addMissingField","getDate","is","datetime","Date","getTime","getEventsSettings","arguments","selectedevents","data","description","events","join","enable_notifi_email","prop","notifi_email","notifi_email_subject","notifi_email_body","emailbodydraftitemid","confirmation_subject","confirmation_message","msgdraftitemid","data_edit","success_message","style","selectedStyle","allowsubmissionsfromdate","allowsubmissionstodate","eventsettings","getSettings","stringify","saveFormSettings","action","callable","selectTemplate","changeEvent","CustomEvent","target","dispatchEvent","push","destroy","initializeTemplate","trigger","showTargetWarning","multiActions","href","changeHeading","formName","show","hide","substr","closest","append","empty","label","parent","detach","prependTo","callbacks","replaceTemplate","msg","formCreateAction","onbeforeunload","formname","mod_edwiserform_return","opener","local_edwiserform_add_new_form","reset","setTimeout","formUpdateAction","local_edwiserform_edit_form","forceupdate","initializeEvents","click","mouseenter","css","offset","top","mouseleave","i","supportedStyles","hasClass","apply","on","toggleImportButton","preventDefault","eleCont","collapseOnly","next","_this","each","node","height","clientHeight","addEventListener","once","toggleEventSettings","temp","shortcode","select","execCommand","validator","validate","formid","_action2","keyup","change","sitekey","ready","loaded","allevents","formdefinition","map","index","require","eventjs"],"mappings":"AAAA,aAwBAA,OAAO,CAAC,SAAU,YAAa,iBAAkB,gCAAiC,4BAA6B,4CAA6C,gCAAiC,+BAAgC,gCAAiC,SAAUC,EAAGC,EAAMC,EAAWC,GAC1R,IAmBIC,EAnBAC,EAAY,CACdC,SAAU,WACVC,UAAW,oBACXC,MAAO,aACPC,WAAY,kBACZC,WAAY,kBACZC,YAAa,eACbC,MAAO,iBACPC,iBAAkB,oBAClBC,MAAO,YACPC,OAAQ,SACRC,WAAY,kBACZC,eAAgB,8BAEdC,EACW,EADXA,EAEY,EAIZC,EAAYC,SAASC,cAAc,eACnCC,EAAkBF,SAASC,cAAchB,EAAUM,aACnDY,GAAQ,EACRC,EAAa,KACbC,EAAa,CACfN,UAAWA,EAEXO,UAAWA,UAEXC,QAASA,QACTC,UAAWC,EAAEC,IAAIC,QAAU,2CAC3BC,cAAc,GAEZC,EAAeb,SAASc,YAAY,SACxCD,EAAaE,UAAU,gBAAgB,GAAM,GAC7CC,OAAOC,UAAY,GACnB,IAAIC,EAAW,CAMbC,aAAc,SAAsBC,GAClC,OAAOvC,EAAKwC,KAAK,CAAC,CAChBC,WAAY,2BACZC,KAAM,CACJC,KAAMJ,MAEN,IASNK,mBAAoB,SAA4BC,EAAOC,GACrD,OAAO9C,EAAKwC,KAAK,CAAC,CAChBC,WAAY,iCACZC,KAAM,CACJG,MAAOA,EACPC,GAAIA,MAEJ,IASNC,gBAAiB,SAAyBC,EAAUC,GAClD,OAAOjD,EAAKwC,KAAK,CAAC,CAChBC,WAAY,8BACZC,KAAM,CACJQ,QAASF,EACTC,QAASA,EAAQE,eAEjB,IASNC,YAAa,SAAqBJ,EAAUC,GAC1C,OAAOjD,EAAKwC,KAAK,CAAC,CAChBC,WAAY,mCACZC,KAAM,CACJQ,QAASF,EACTC,QAASA,EAAQE,eAEjB,KAGJE,EAAY,CAOdC,mBAAoB,SAA4BT,EAAOF,GACrD,IAAIY,EAAM,CACRV,MAAOA,EACPF,KAAMA,GAER,OAAO1C,EAAUuD,OAAO,6CAA8CD,KA8B1E/B,EAAWiC,UAvBK,WACdtD,EAAOuD,IAAIC,UACX,IAAIC,EAAW7D,EAAEK,EAAUC,UAAUwD,MACrCxB,EAASC,aAAasB,GAAUE,KAAK,SAAUC,GAG7C,GAFA5D,EAAOuD,IAAIM,eAEY,GAAnBD,EAASE,OASX,OARAzC,EAAWN,UAAYA,EAEvBf,EAAS,IAAI+D,OAAO1C,EAAYuC,EAASI,iBACzCpE,EAAEK,EAAUG,OAAOsD,MAAMO,QAAQ,SAAUvB,GACrCV,OAAOC,UAAUS,GAAOwB,eAAe,sBAAwBlC,OAAOC,UAAUS,GAAOyB,qBACzFC,EAAuB1B,OAK5B2B,KAAK,SAAUC,GAChBtE,EAAOuD,IAAIM,eACX7D,EAAOuD,IAAIgB,MAAM,SAAUD,EAAGE,YAKlCnD,EAAWoD,UAA2C,SAA/B7E,EAAEK,EAAUC,UAAUwD,MAM7C,IAAIgB,EAA4B,CAC9BC,qBAAsB,SAA8BC,EAAQC,GAC1D,GAAID,EAAOE,OAASlF,EAAEK,EAAUC,UAAUwD,MAA1C,CAKA,IAAIqB,EAAeC,KAAKC,kBAAkBC,eAAeN,GAErDG,GAAgBA,EAAaI,OAC/BJ,EAAaI,MAAMC,YAAYJ,KAAKK,QAAQC,mBAG1CT,EACFA,EAAYU,SAGZP,KAAKQ,IAAIC,KAAKC,kBAAkBV,KAAKK,QAAQM,iBAAmB,gBAAkBf,EAAOE,MAAQ,MAAMS,SAGzGP,KAAKY,oBACLZ,KAAKa,eACLjG,EAAE,cAAgBgF,EAAOE,OAAOS,cAnB9BvF,EAAOuD,IAAIuC,QAAQrE,EAAEsE,KAAKC,WAAW,0BAA2B/F,EAAUE,UAAWP,EAAEK,EAAUC,UAAUuF,KAAK,mBAAmBQ,QAAS,MAqBhJC,kBAAmB,SAA2BtB,GAC5C,IAAII,KAAKC,kBAAkBkB,WAAWvB,EAAOE,OAI7C,QAA6C,IAAlC9C,OAAOC,UAAU2C,EAAOE,OAAnC,CAOI9C,OAAOC,UAAU2C,EAAOE,OAAOZ,eAAe,sBAAwBlC,OAAOC,UAAU2C,EAAOE,OAAOX,qBACvGC,EAAuBQ,EAAOE,OAGhCE,KAAKC,kBAAkBmB,YAAYxB,GACnC,IAAIyB,EAAgBrB,KAAKC,kBAAkBqB,UAAU,SAAUC,GAC7D,OAAOA,EAAMzB,QAAUF,EAAOE,QAG5BE,KAAKwB,WAEPxB,KAAKyB,WAAazB,KAAK0B,cAAc9B,IAGrCI,KAAK2B,YAAc3B,KAAK2B,WAAWC,aAAaxB,YAAYJ,KAAKK,QAAQC,mBAEzEN,KAAK6B,YAAc7B,KAAK6B,WAAWC,KAAKlC,EAAOkC,OAIjDT,GAAiBA,EAAclB,MAAM4B,SAAS/B,KAAKK,QAAQC,mBAC3DN,KAAKY,oBAELoB,iBAAiB/C,QAAQ,SAAUgD,GAC7BrC,EAAOE,OAASmC,GAClBC,EAAiBD,GAAQtD,KAAK,SAAUC,GACtCV,EAAUC,mBAAmB8D,EAAQrC,EAAOkC,MAAMnD,KAAK,SAAUsC,EAAMkB,GACrErH,EAAUsH,mBAAmBxH,EAAEK,EAAUI,YAAa4F,EAAMkB,GAC5DvH,EAAE,cAAgBqH,EAAS,wBAAwBhB,KAAKrC,EAASf,UAE1C,GAAnBe,EAASE,QAAkB9B,OAAOC,UAAUgF,GAAQ/C,eAAe,SACrElC,OAAOC,UAAUgF,GAAQI,kBArCjCrH,EAAOuD,IAAIgB,MAAM,SAAU9C,EAAEsE,KAAKC,WAAW,6BAA8B/F,EAAUE,WAAY,WAC/F6B,OAAOsF,SAASC,aAiDxB,SAASC,IACP,IAAI1E,EAAU2E,KAAKC,MAAMC,KACzB,OAA6C,GAAtCC,OAAOC,KAAK/E,EAAQgF,QAAQC,OAOrC,SAASC,IACP,IAAIC,EAAYT,IAChB5H,EAAE,qBAAqBsI,YAAY,SAAUD,GAC7CrI,EAAE,0BAA0BsI,YAAY,SAAUD,GAQpD,SAASN,IACP,OAAO3H,EAAOmI,SAQhB,SAASC,IACP,IAAItE,EAASuE,KAAmBC,GAAW,KAAWd,IAGtD,OAFA5H,EAAE,+BAA+B2I,QAAQ,sBAAsBL,YAAY,UAAWpE,GACtFlE,EAAE,kBAAkBsI,YAAY,UAAWpE,GACpCA,EAST,SAASoD,EAAiBxE,GACxB,IAAIC,EAAK/C,EAAE,eAAe8D,MACtB8E,EAAUtG,EAASO,mBAAmBC,EAAa,IAANC,EAAWA,EAAK,MAMjE,OALA6F,EAAQnE,KAAK,SAAUC,GACrBtE,EAAOuD,IAAIM,eAEX4E,QAAQC,IAAIpE,KAEPkE,EAQT,SAASH,IACP,OAAOzI,EAAEK,EAAUY,gBAAgB4E,KAAK,oBAAoBsC,OAAS,EAQvE,SAASY,EAAYhG,GACnB/C,EAAEK,EAAUO,OAAO4E,YAAYnF,EAAUU,QACzCf,EAAE,QAAU+C,GAAIoE,SAAS9G,EAAUU,QACnCf,EAAE,mBAAmBwF,YAAYnF,EAAUU,QAC3Cf,EAAE,aAAe+C,GAAIoE,SAAS9G,EAAUU,QAS1C,SAAS2H,EAAWM,GACDC,MAAbD,IACFA,GAAY,GAGd,IAAI/F,EAAWiG,IACXC,EAASnJ,EAAEK,EAAUO,MAAQ,IAAMP,EAAUU,QAAQqI,KAAK,MAC1DC,EAA+B,IAAlBpG,EAASqG,MAE1B,IAAKN,EACH,OAAOK,EAGT,GAAKA,EAiBHrJ,EAAE,6BAA6BwF,YAAY,cAC3CxF,EAAEK,EAAUS,OAAO6H,QAAQ,UAAUnD,YAAY,kBAlBlC,CACf,OAAQ2D,GACN,IAAK,iBACL,IAAK,mBACL,IAAK,mBAKL,IAAK,oBACHJ,EAAY,iBACZ/I,EAAEK,EAAUS,OAAO6H,QAAQ,UAAUxB,SAAS,cAIlD/G,EAAOuD,IAAIuC,QAAQrE,EAAEsE,KAAKC,WAAW,wBAAyB/F,EAAUE,WAAY,KAMtF,OAAO8I,EAuCT,IAAI7E,EAAyB,SAAgC5B,GAC3DN,EAASC,aAAaK,GAAMmB,KAAK,SAAUC,GACzC,GAAuB,GAAnBA,EAASE,OAAgB,CAC3B,IAAIqE,EAAWV,KAAKC,MAAM9D,EAASI,YACnC4D,OAAOC,KAAKM,EAASL,QAAQ7D,QAAQ,SAAUkF,GACzChB,EAASL,OAAOqB,GAAOjF,eAAe,UAAYiE,EAASL,OAAOqB,GAAOC,MAAMlF,eAAe,aAAeiE,EAASL,OAAOqB,GAAOC,MAAMC,UAAYlB,EAASL,OAAOqB,GAAOjF,eAAe,UAAYiE,EAASL,OAAOqB,GAAOC,MAAMlF,eAAe,UAAYlE,EAAOuD,IAAI+F,iBAAiBnB,EAASL,OAAOqB,GAAOC,MAAM5G,eACpT2F,EAASL,OAAOqB,GAAOC,MAAMG,SACpCvJ,EAAOwJ,gBAAgBrB,EAASL,OAAOqB,UAI5C9E,KAAK,SAAUC,GAChB1E,EAAE,mBAAqB4C,EAAO,MAAM+F,QAAQtI,EAAUQ,kBAAkB2E,YAAY,WACpFpF,EAAOuD,IAAIgB,MAAM,SAAUD,EAAGE,YAUlC,SAASiF,EAAQ9G,GACf,GAAI/C,EAAE+C,EAAK,YAAY+G,GAAG,YAAa,CACrC,IAAIC,EAAW/J,EAAE+C,EAAK,SAASe,MAK/B,OAJAiG,GAAY,IAAM/J,EAAE+C,EAAK,UAAUe,MACnCiG,GAAY,IAAM/J,EAAE+C,EAAK,QAAQe,MACjCiG,GAAY,IAAM/J,EAAE+C,EAAK,SAASe,MAClCiG,GAAY,IAAM/J,EAAE+C,EAAK,WAAWe,MAAQ,MACrC,IAAIkG,KAAKD,GAAUE,UAAY,IAGxC,OAAO,EAST,SAASf,IACP,IAAIgB,EAAoBC,UAAUhC,OAAS,QAAsBc,IAAjBkB,UAAU,IAAmBA,UAAU,GACnF3H,EAAOxC,EAAEK,EAAUC,UAAUwD,MAC7BsG,EAAiBpK,EAAEK,EAAUG,OAAOsD,MACpCuG,EAAO,CACTf,MAAStJ,EAAEK,EAAUS,OAAOgD,MAC5BwG,YAAetK,EAAE,mBAAmB8D,MACpCtB,KAAQA,EACR+H,OAAUH,EAAeI,OACzBC,oBAAuBzK,EAAE,2BAA2B0K,KAAK,WACzDC,aAAgB3K,EAAE,oBAAoB8D,MACtC8G,qBAAwB5K,EAAE,4BAA4B8D,MACtD+G,kBAAqB7K,EAAE,yBAAyB8D,MAChDgH,qBAAwB9K,EAAE,sCAAsC8D,MAChEiH,qBAAwB/K,EAAE,4BAA4B8D,MACtDkH,qBAAwBhL,EAAE,wBAAwB8D,MAClDmH,eAAkBjL,EAAE,qCAAqC8D,MACzDoH,UAAalL,EAAE,gBAAgB0K,KAAK,WACpCS,gBAAmBnL,EAAE,uBAAuB8D,MAE5CsH,MAASC,cACTC,yBAA4BzB,EAAQ,gCACpC0B,uBAA0B1B,EAAQ,8BAClC2B,cAAiB,IAGnB,GAAyB,GAArBtB,EAA2B,CAC7B,IAAIsB,EAAgB,GACpBpB,EAAe/F,QAAQ,SAAUvB,GAE/BsE,iBAAiB/C,QAAQ,SAAUgD,GAC7BvE,GAASuE,IACXmE,EAAc1I,GAASV,OAAOC,UAAUS,GAAO2I,mBAIrDpB,EAAKmB,cAAgB3D,KAAK6D,UAAUF,GAGtC,OAAOnB,EAWT,SAASsB,EAAiBC,EAAQ3I,EAAUC,EAAS2I,GACnDzL,EAAOuD,IAAIC,WACA,UAAVgI,EAAqBtJ,EAASU,gBAAgBC,EAAUC,GAAWZ,EAASe,YAAYJ,EAAUC,IAAUa,KAAK8H,GAAUpH,KAAK,SAAUC,GACzItE,EAAOuD,IAAIM,eACX7D,EAAOuD,IAAIgB,MAAM,SAAUD,EAAGE,WAUlC,SAASkH,EAAejI,GACtB,IAAI8F,EAAWQ,UAAUhC,OAAS,QAAsBc,IAAjBkB,UAAU,GAAmBA,UAAU,GAAK,GACnF1I,EAAWoD,UAAwB,SAAZhB,EACvB7D,EAAEK,EAAUC,UAAUwD,IAAID,GAE1B,IAAIkI,EAAc,IAAIC,YAAY,SAAU,CAC1CC,OAAQjM,EAAEK,EAAUC,UAAU,KAEhCN,EAAEK,EAAUC,UAAU,GAAG4L,cAAcH,GACvC,IAAIxB,EAAS,GACbA,EAAO4B,KAAKtI,GACZ7D,EAAEK,EAAUG,OAAOsD,IAAIyG,GAEvBwB,EAAc,IAAIC,YAAY,SAAU,CACtCC,OAAQjM,EAAEK,EAAUG,OAAO,KAE7BR,EAAEK,EAAUG,OAAO,GAAG0L,cAAcH,GACpCvK,EAAW4K,UACX5K,EAAWiG,KAAKzH,EAAEK,EAAUG,OAAQR,EAAEK,EAAUG,OAAOsD,OACvDuI,IACA5K,EAAWN,UAAYA,EAEvBf,EAAS,IAAI+D,OAAO1C,EAAYkI,GAChC3J,EAAE,sBAAsBsM,QAAQ,SAQlC,SAASC,EAAkBN,GACzB7L,EAAOuD,IAAI6I,aAAa,UAAW3K,EAAEsE,KAAKC,WAAW,YAAa/F,EAAUE,WAAYsB,EAAEsE,KAAKC,WAAW,gCAAiC/F,EAAUE,UAAWP,EAAEiM,GAAQ5B,KAAK,kBAAmB,CAAC,CACjMf,MAAOzH,EAAEsE,KAAKC,WAAW,kBAAmB/F,EAAUE,WACtDiC,KAAM,UACNoJ,OAAQ,WACNxJ,OAAOsF,SAAS+E,KAAO5K,EAAEC,IAAIC,QAAU,6FAExC,CACDuH,MAAOzH,EAAEsE,KAAKC,WAAW,SAAU/F,EAAUE,WAC7CiC,KAAM,aASV,SAASkK,EAAcC,GACrB3M,EAAE,sBAAsBsI,YAAY,WAAYqE,EAASxE,OAAS,GAE9DwE,EAASxE,OAAS,EACpBnI,EAAE,4BAA4B4M,OAE9B5M,EAAE,4BAA4B6M,OAG5BF,EAASxE,OAAS,KACpBwE,EAAWA,EAASG,OAAO,EAAG,IAAM,OAGtC9M,EAAE,mBAAmBkH,KAAKyF,GAO5B,SAASN,IAEPrM,EAAEK,EAAUC,UAAUyM,QAAQ,UAAUF,OAEF,GAAlC7M,EAAEK,EAAUI,YAAY0H,OAC1BnI,EAAE,wBAAwBgN,OAAO,sCAEjChN,EAAEK,EAAUI,YAAYwM,QAG1B,IAAIC,EAAQlN,EAAE,wCAAwCmN,SAClDhM,EAAYnB,EAAEkN,GAAOC,SACzBD,EAAME,SAASC,UAAUlM,GACzB+L,EAAQlN,EAAE,sCAAsCmN,SAChDhM,EAAYnB,EAAEkN,GAAOC,SACrBD,EAAME,SAASC,UAAUlM,GACzBnB,EAAEK,EAAUG,OAAOsD,MAAMO,QAAQ,SAAUvB,GAEzCsE,iBAAiB/C,QAAQ,SAAUgD,GAC7BvE,GAASuE,GACXC,EAAiBxE,GAAOiB,KAAK,SAAUC,GACrCV,EAAUC,mBAAmBT,EAAO9C,EAAEK,EAAUG,OAAOqF,KAAK,iBAAmB/C,EAAQ,MAAMuD,QAAQtC,KAAK,SAAUsC,EAAMkB,GACxHrH,EAAUsH,mBAAmBxH,EAAEK,EAAUI,YAAa4F,EAAMkB,GAC5DvH,EAAE,cAAgB8C,EAAQ,wBAAwBuD,KAAKrC,EAASf,eAE1B,IAA3Bb,OAAOC,UAAUS,GAOL,GAAnBkB,EAASE,QAAkB9B,OAAOC,UAAUS,GAAOwB,eAAe,SACpElC,OAAOC,UAAUS,GAAO2E,OAPxBrH,EAAOuD,IAAIgB,MAAM,SAAU9C,EAAEsE,KAAKC,WAAW,6BAA8B/F,EAAUE,WAAY,WAC/F6B,OAAOsF,SAASC,mBAcX,OAAfnG,IACFA,EAAaxB,EAAEK,EAAUG,OAAOqM,OAAOrL,WAAW,CAChD8L,UAAWxI,KAUjB,SAASyI,EAAgB5D,GACvB,IAAI9F,EAAW7D,EAAE2J,GAAUU,KAAK,YAChCrK,EAAE2J,GAAUhB,QAAQtI,EAAUQ,kBAAkBsG,SAAS,WACzD7E,EAASC,aAAasB,GAAUE,KAAK,SAAUC,GAC7ChE,EAAE2J,GAAUhB,QAAQtI,EAAUQ,kBAAkB2E,YAAY,WAErC,GAAnBxB,EAASE,QAKO,oBAAhBF,EAASwJ,KACXpN,EAAOuD,IAAIgB,MAAM,UAAWX,EAASwJ,IAAK,WACxC1B,EAAejI,EAAUG,EAASI,cAItCmI,EAAkB5C,IAVhBmC,EAAejI,EAAUG,EAASI,cAWnCK,KAAK,SAAUC,GAChB1E,EAAE2J,GAAUhB,QAAQtI,EAAUQ,kBAAkB2E,YAAY,WAC5DpF,EAAOuD,IAAIgB,MAAM,SAAUD,EAAGE,WASlC,IAAI6I,EAAmB,SAA0BzJ,GAG/C,GAFA5D,EAAOuD,IAAIM,eAEY,GAAnBD,EAASE,OAAgB,CAK3B,GAJA9B,OAAOsL,eAAiB,KACxBnM,GAAQ,EACRyC,EAAS2J,SAAW3N,EAAEK,EAAUS,OAAOgD,MAETmF,MAA1B2E,wBAAiE,GAA1BA,uBAEzC,YADAxL,OAAOyL,OAAOC,+BAA+B9J,GAI/C5D,EAAOuD,IAAIgB,MAAM,UAAWX,EAASwJ,IAAK,WACxCpN,EAAO2N,QACP/N,EAAE0H,UAAU0B,KAAK,OAAQvH,EAAEC,IAAIC,QAAU,gDAE3CiM,WAAW,WACThO,EAAE0H,UAAU0B,KAAK,OAAQvH,EAAEC,IAAIC,QAAU,+CACxC,UAEH3B,EAAOuD,IAAIgB,MAAM,SAAUX,EAASwJ,MASpCS,EAAmB,SAASA,EAAiBjK,GAG/C,GAFA5D,EAAOuD,IAAIM,eAEPD,EAASE,QAAUhD,EAAuB,CAI5C,GAHAkB,OAAOsL,eAAiB,KACxB1J,EAAS2J,SAAW3N,EAAEK,EAAUS,OAAOgD,MAETmF,MAA1B2E,wBAAiE,GAA1BA,uBAEzC,YADAxL,OAAOyL,OAAOK,4BAA4BlK,GAI5C5D,EAAOuD,IAAI6I,aAAa,UAAW3K,EAAEsE,KAAKC,WAAW,UAAW/F,EAAUE,WAAYyD,EAASwJ,IAAK,CAAC,CACnGlE,MAAOzH,EAAEsE,KAAKC,WAAW,wBAAyB/F,EAAUE,WAC5DiC,KAAM,UACNoJ,OAAQ,WACN5L,EAAE0H,UAAU0B,KAAK,OAAQvH,EAAEC,IAAIC,QAAU,gDAE1C,CACDuH,MAAOzH,EAAEsE,KAAKC,WAAW,QAAS/F,EAAUE,WAC5CiC,KAAM,kBAEH,GAAIwB,EAASE,QAAUhD,EAAwB,CACpD,IACIgC,EAAU6E,IACV9E,EAAWiG,GAAgB,GAC/BjG,EAASkL,aAAc,EACvBlL,EAASF,GAAK/C,EAAE,eAAe8D,MAC/B1D,EAAOuD,IAAI6I,aAAa,UAAW3K,EAAEsE,KAAKC,WAAW,YAAa/F,EAAUE,WAAYyD,EAASwJ,IAAK,CAAC,CACrGlE,MAAOzH,EAAEsE,KAAKC,WAAW,UAAW/F,EAAUE,WAC9CiC,KAAM,UACNoJ,OAAQ,WACND,EATU,SASgB1I,EAAUC,EAAS+K,KAE9C,CACD3E,MAAOzH,EAAEsE,KAAKC,WAAW,SAAU/F,EAAUE,WAC7CiC,KAAM,kBAGRpC,EAAOuD,IAAIgB,MAAM,SAAUX,EAASwJ,MAQxC,SAASY,IACPpO,EAAE,8CAA8CqO,MAAM,WACpDrO,EAAEoF,MAAMuD,QAAQ,iBAAiBL,YAAY,eAC7CtI,EAAE,2CAA2C+M,QAAQ,eAAezE,YAAY,qBAElFtI,EAAEK,EAAUK,YAAY4N,WAAW,WACjCtO,EAAE,uBAAuBoJ,KAAK,MAAOpJ,EAAEoF,MAAMS,KAAK,OAAOuD,KAAK,QAAQmF,IAAI,MAAOvO,EAAEoF,MAAMoJ,SAASC,KAAK7B,SACtG8B,WAAWrO,EAAUK,WAAY,WAClCV,EAAE,uBAAuBoJ,KAAK,MAAO,IAAIyD,SACxCwB,MAAMhO,EAAUK,WAAY,WAC7BV,EAAEK,EAAUK,YAAY8E,YAAY,YACpCxF,EAAEoF,MAAM+B,SAAS,YAEjB,IAAK,IAAIwH,EAAI,EAAGA,GAAKC,gBAAiBD,IAChC3O,EAAEK,EAAUM,aAAakO,SAAS,cAAgBF,IACpDxO,EAAW2O,MAAM9O,EAAEK,EAAUM,aAAc,SAAUgO,GAKzDtD,cAAgBrL,EAAEoF,MAAMiF,KAAK,QAC7BlK,EAAW2O,MAAM9O,EAAEK,EAAUM,aAAc,MAAOX,EAAEoF,MAAMiF,KAAK,WAEjErK,EAAE,+BAA+BqO,MAAM,WAEtB,aAAX1M,SAAoD,uBAA1B3B,EAAEoF,MAAMiF,KAAK,WAc3CrK,EAAE,+BAA+BwF,YAAY,UAC7CxF,EAAEoF,MAAM+B,SAAS,UACjBnH,EAAE,qBAAqBwF,YAAY,UACnCxF,EAAE,IAAMA,EAAEoF,MAAMiF,KAAK,WAAWlD,SAAS,WAhBvC/G,EAAOuD,IAAI6I,aAAa,UAAW3K,EAAEsE,KAAKC,WAAW,YAAa/F,EAAUE,WAAYsB,EAAEsE,KAAKC,WAAW,gCAAiC/F,EAAUE,UAAWP,EAAEoF,MAAMS,KAAK,MAAMqB,QAAS,CAAC,CAC3LoC,MAAOzH,EAAEsE,KAAKC,WAAW,kBAAmB/F,EAAUE,WACtDiC,KAAM,UACNoJ,OAAQ,WACNxJ,OAAOsF,SAAS+E,KAAO5K,EAAEC,IAAIC,QAAU,6FAExC,CACDuH,MAAOzH,EAAEsE,KAAKC,WAAW,SAAU/F,EAAUE,WAC7CiC,KAAM,eAUZxC,EAAE,mCAAmCqO,MAAM,cAG3CrO,EAAE,+BAA+BqO,MAAM,cAGvCrO,EAAEoB,UAAU2N,GAAG,gBAAiB,WAC9B,IAAI7K,EAASsE,IACbJ,IAEKlE,GACHlE,EAAEK,EAAUG,OAAOsD,MAAMO,QAAQ,SAAUvB,GACrCV,OAAOC,UAAUS,GAAOwB,eAAe,sBAAwBlC,OAAOC,UAAUS,GAAOyB,qBACzFC,EAAuB1B,KAK7B1C,EAAOuD,IAAIqL,uBAEbhP,EAAE,kBAAkBqO,MAAM,SAAUvL,GAClCA,EAAMmM,iBACN,IAAIlM,EAAK/C,EAAEoF,MAAMiF,KAAK,MACtBrK,EAAE,IAAM+C,GAAIsL,UAEdrO,EAAEK,EAAUO,OAAOyN,MAAM,SAAUvL,GACjC,IAAK2F,IAIH,OAHArI,EAAOuD,IAAIuC,QAAQrE,EAAEsE,KAAKC,WAAW,8BAA+B/F,EAAUE,WAAY,KAC1FwI,EAAY,mBACZjG,EAAMmM,iBAIR,IAAIlM,EAAK/C,EAAEoF,MAAMgE,KAAK,MAEtB,GAAU,kBAANrG,GAAgC,qBAANA,GAA8B2F,IAA5D,CAKAF,IACA,IAAI0G,EAAUlP,EAAEoF,MAAMiF,KAAK,SAO3B,GANArK,EAAE,6EAA6EwF,YAAYnF,EAAUU,QACrGf,EAAE,iGAAiGwF,YAAYnF,EAAUU,QACzHf,EAAEkP,GAAS/H,SAAS9G,EAAUU,QAC9Bf,EAAEoF,MAAM+B,SAAS9G,EAAUU,QAC3Bf,EAAE,4BAA4BkH,KAAKlH,EAAEoF,MAAMiF,KAAK,cAE5C,0BAA4B6E,EAAS,CACvC9O,EAAOqD,OAAOnC,GAEd,IAAK,IAAIqN,EAAI,EAAGA,GAAKC,gBAAiBD,IAChC3O,EAAEK,EAAUM,aAAakO,SAAS,cAAgBF,IACpDxO,EAAW2O,MAAM9O,EAAEK,EAAUM,aAAc,SAAUgO,GAKzDxO,EAAW2O,MAAM9O,EAAEK,EAAUM,aAAc,MAAO0K,qBAtBlDvI,EAAMmM,mBAyBVjP,EAAE,QAAQ+O,GAAG,QAAS,mBAAoB,SAAUjM,GAClD,IAAIqM,EAAehF,UAAUhC,OAAS,QAAsBc,IAAjBkB,UAAU,GAAmBA,UAAU,GAAK,KAE1D,IAAzBnK,EAAEoF,MAAMgK,OAAO/I,QAxdvB,SAA6BgJ,EAAOF,GAClC,GAAInP,EAAEqP,GAAOlC,OAAO,cAAc0B,SAAS,aAAc,CAClDM,GACHnP,EAAE,iCAAiCsP,KAAK,SAAUX,EAAGY,GACnDvP,EAAEuP,GAAMjD,QAAQ,QAAS,EAAC,MAI9BtM,EAAEqP,GAAOlC,OAAO,cAAc3H,YAAY,aAC1CxF,EAAEqP,GAAOD,OAAOI,OAAO,QACvB,IAAIA,EAASxP,EAAEqP,GAAOD,OAAO,GAAGK,aAAe,KAC/CzP,EAAEqP,GAAOD,OAAOI,OAAO,OACvBxB,WAAW,WACThO,EAAEqP,GAAOD,OAAOI,OAAOA,IACtB,QAEHxP,EAAEqP,GAAOD,OAAOI,OAAO,OACvBxP,EAAEqP,GAAOD,OAAO,GAAGM,iBAAiB,gBAAiB,WACnD1P,EAAEqP,GAAOlC,OAAO,cAAchG,SAAS,cACtC,CACDwI,MAAM,IAwcRC,CAAoBxK,KAAM+J,KAE3BJ,GAAG,QAAS,iBAAkB,WAC7B,IAAIc,EAAO7P,EAAE,WACbA,EAAE,QAAQgN,OAAO6C,GACjB,IAAIC,EAAY9P,EAAEoF,MAAM8B,OACxB2I,EAAK/L,IAAIgM,GAAWC,SACpB3O,SAAS4O,YAAY,QACrBH,EAAKlK,SACLvF,EAAOuD,IAAIuC,QAAQrE,EAAEsE,KAAKC,WAAW,kBAAmB/F,EAAUE,UAAWuP,GAAY,OAE1Ff,GAAG,QAAS,8BAA+B,SAAUjM,GACpD,IAAK2F,IAIH,OAHArI,EAAOuD,IAAIuC,QAAQrE,EAAEsE,KAAKC,WAAW,8BAA+B/F,EAAUE,WAAY,KAC1FwI,EAAY,mBACZjG,EAAMmM,iBAIR,GAAKvG,KAAiBtI,EAAO6P,UAAUC,WAAvC,CAIA,IAAIjN,EAAWiG,GAAgB,GAE/B,GAAIjG,EAASqI,0BAA4BrI,EAASsI,wBAA6D,GAAnCtI,EAASsI,uBACnFvL,EAAE,uCAAuCmN,OAAO,wBAAwBiC,OAAOxC,OAAO1F,KAAKrF,EAAEsE,KAAKC,WAAW,gCAAiC/F,EAAUE,YAAYoI,QAAQ,yBAAyBxB,SAAS,kBADhN,CAIEnH,EAAE,uCAAuCmN,OAAO,wBAAwBiC,OAAOxC,OAAO1F,KAAK,IAAIyB,QAAQ,yBAAyBnD,YAAY,cAG9I,IAAItC,EAAU6E,IACVoI,EAASnQ,EAAE,eAAe8D,MAC1BsM,EAAW,SAEXD,EACF/P,EAAOuD,IAAI6I,aAAa,UAAW3K,EAAEsE,KAAKC,WAAW,YAAa/F,EAAUE,WAAYsB,EAAEsE,KAAKC,WAAW,2BAA4B/F,EAAUE,WAAY,CAAC,CAC3J+I,MAAOzH,EAAEsE,KAAKC,WAAW,8BAA+B/F,EAAUE,WAClEiC,KAAM,UACNoJ,OAAQ,WACND,EAAiByE,EAAUnN,EAAUC,EAASuK,KAE/C,CACDnE,MAAOzH,EAAEsE,KAAKC,WAAW,sCAAuC/F,EAAUE,WAC1EiC,KAAM,UACNoJ,OAAQ,WACNwE,EAAW,SACXnN,EAASF,GAAKoN,EACdxE,EAAiByE,EAAUnN,EAAUC,EAAS+K,OAM/C1M,EAGHnB,EAAOuD,IAAIuC,QAAQrE,EAAEsE,KAAKC,WAAW,yBAA0B/F,EAAUE,WAAY,KAFrFoL,EAAiByE,EAAUnN,EAAUC,EAASuK,OAKlDzN,EAAEK,EAAUW,YAAYqP,MAAM,WAC5B,IAAI1D,EAAW3M,EAAEoF,MAAMtB,MACnBmJ,EAAoB,IAAZN,EACZ3M,EAAEoF,MAAM+H,SAAS7E,YAAY,aAAc2E,GAC3CjN,EAAEK,EAAUS,OAAOgD,IAAI6I,GACvBD,EAAcC,KACb2D,OAAO,WACR9H,MAEFxI,EAAEK,EAAUS,OAAOuP,MAAM,WACvB,IAAI1D,EAAW3M,EAAEoF,MAAMtB,MACvB9D,EAAEK,EAAUS,OAAOgD,IAAI6I,GACvBD,EAAcC,KACb2D,OAAO,WACR,IAAI3D,EAAW3M,EAAEoF,MAAMtB,MACvB9D,EAAEK,EAAUW,YAAY8C,IAAI6I,GAC5BnE,MAEFxI,EAAEK,EAAUC,UAAUgQ,OAAO,WAC3BtQ,EAAEK,EAAUY,gBAAgB4E,KAAK,aAAaL,YAAY,UAC1D,IAAIhD,EAAOxC,EAAEoF,MAAMtB,MACnB9D,EAAEK,EAAUY,gBAAgB4E,KAAK,aAAerD,GAAM2E,SAAS,UAC/DnH,EAAE,4BAA4B0K,KAAK,WAAW,KAEhD1K,EAAEK,EAAUY,gBAAgB4E,KAAK,oBAAoBwI,MAAM,WACzD,IAAIgB,EAAQjK,KAGe,GAAvBpF,EAAEoF,MAAMiF,KAAK,QAA6B,aAAX1I,SAKnC6G,IAEIxI,EAAEK,EAAUY,gBAAgB4E,KAAK,oBAAoBsC,SAAWP,IAClExH,EAAOuD,IAAI6I,aAAa,UAAW3K,EAAEsE,KAAKC,WAAW,YAAa/F,EAAUE,WAAYsB,EAAEsE,KAAKC,WAAW,8BAA+B/F,EAAUE,WAAY,CAAC,CAC9J+I,MAAOzH,EAAEsE,KAAKC,WAAW,UAAW/F,EAAUE,WAC9CiC,KAAM,UACNoJ,OAAQ,WACN2B,EAAgB8B,KAEjB,CACD/F,MAAOzH,EAAEsE,KAAKC,WAAW,SAAU/F,EAAUE,WAC7CiC,KAAM,aAGR+K,EAAgB8B,IAlBhB9C,EAAkBnH,QAqBtBpF,EAAEoB,UAAU2N,GAAG,eAAgB,WAC7B3G,MAEFhH,SAASsO,iBAAiB,eAAgB,WACxCrD,IACA7D,IACApI,EAAOuD,IAAIM,iBAyDf,MAAO,CACLwD,KApBS,SAAc8I,GACvBvQ,EAAEoB,UAAUoP,MAAM,WA/BpB,IACMC,EACAC,EA8BFjP,EAAW8O,QAAUA,EAInBnQ,EAF2B,oBAAlBuQ,eAEA,IAAIxM,OAAO1C,EAAYkP,gBAGvB,IAAIxM,OAAO1C,GAGtB2G,IACApI,EAAE,sBAAsB6M,OACxBzM,EAAOuD,IAAIC,UA3CT6M,EAAS,GACTC,EAAY1Q,EAAEK,EAAUG,OAAOqF,KAAK,UAAU+K,IAAI,SAAUC,EAAO/N,GACrE,OAAOA,EAAMoC,SAGDiD,OAAS,EACrBuI,EAAUpB,KAAK,SAAUuB,EAAOxJ,GAC9ByJ,QAAQ,CAAC,qBAAuBzJ,EAAS,aAAc,SAAU0J,GAC/D3O,OAAOC,UAAUgF,GAAU0J,EAEvBL,EAAUvI,UAAYsI,IACxBzQ,EAAE,0BAA0B4M,OAC5BwB,IACAhN,SAAS8K,cAAcjK,SAO/BmM,IACApO,EAAE,0BAA0B4M","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Edwiser Form new_form_main js\n * @package   local_edwiserform\n * @copyright (c) 2020 WisdmLabs (https://wisdmlabs.com/) <support@wisdmlabs.com>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author    Yogesh Shirsath\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/templates',\n    'local_edwiserform/form_styles',\n    'local_edwiserform/iefixes',\n    'local_edwiserform/efb_form_basic_settings',\n    'local_edwiserform/formbuilder',\n    'local_edwiserform/fastsearch',\n    'local_edwiserform/fastselect'\n], function($, ajax, Templates, formStyles) {\n    var SELECTORS = {\n        FORMTYPE: '#id_type',\n        COMPONENT: 'local_edwiserform',\n        EVENT: '#id_events',\n        EVENT_LIST: '.efb-event-list',\n        FORM_STYLE: '.efb-form-style',\n        RENDER_FORM: '.render-form',\n        PANEL: '.efb-panel-btn',\n        TEMPLATE_OVERLAY: '.template-overlay',\n        TITLE: '#id_title',\n        ACTIVE: 'active',\n        FORM_TITLE: '#efb-form-title',\n        TEMPLATES_ROOT: '.efb-forms-setup-templates'\n    };\n    var CONSTANTS = {\n        FORM_UPDATE: 1,\n        FORM_OVERITE: 2,\n        UPDATE_FAILED: 3\n    };\n    var formeo;\n    var container = document.querySelector('.build-form');\n    var renderContainer = document.querySelector(SELECTORS.RENDER_FORM);\n    var saved = false;\n    var fastselect = null;\n    var formeoOpts = {\n        container: container,\n        // eslint-disable-next-line no-undef\n        countries: countries,\n        // eslint-disable-next-line no-undef\n        license: license,\n        svgSprite: M.cfg.wwwroot + '/local/edwiserform/pix/formeo-sprite.svg',\n        localStorage: false,\n    };\n    var eventsLoaded = document.createEvent('Event');\n    eventsLoaded.initEvent('eventsLoaded', true, true);\n    window.eventlist = [];\n\n    var PROMISES = {\n        /**\n         * Call moodle service edwiser_get_template\n         * @param  {String}  type Type of form\n         * @return {Promise}      Ajax promise call\n         */\n        GET_TEMPLATE: function(type) {\n            return ajax.call([{\n                methodname: 'edwiserform_get_template',\n                args: {\n                    name: type\n                }\n            }])[0];\n        },\n        /**\n         * Call moodle service edwiser_get_template\n         * @param  {String}  event Event name\n         * @param  {Number}  id    Form id\n         * @return {Promise}       Ajax promise call\n         */\n        GET_EVENT_SETTINGS: function(event, id) {\n            return ajax.call([{\n                methodname: 'edwiserform_get_event_settings',\n                args: {\n                    event: event,\n                    id: id\n                }\n            }])[0];\n        },\n        /**\n         * Call moodle service edwiser_get_template\n         * @param  {Object}  settings JSON form settings\n         * @param  {String}  formdef  JSON form definition\n         * @return {Promise}          Ajax promise call\n         */\n        CREATE_NEW_FORM: function(settings, formdef) {\n            return ajax.call([{\n                methodname: \"edwiserform_create_new_form\",\n                args: {\n                    setting: settings,\n                    formdef: formdef.toString()\n                }\n            }])[0];\n        },\n        /**\n         * Call moodle service edwiser_get_template\n         * @param  {Object}  settings form settings object\n         * @param  {String}  formdef  JSON form definition\n         * @return {Promise}          Ajax promise call\n         */\n        UPDATE_FORM: function(settings, formdef) {\n            return ajax.call([{\n                methodname: \"edwiserform_update_form_settings\",\n                args: {\n                    setting: settings,\n                    formdef: formdef.toString()\n                }\n            }])[0];\n        }\n    };\n\n    var TEMPLATES = {\n        /**\n         * Call moodle template event_settings_container\n         * @param  {String} event Event type\n         * @param  {String} name  Event name\n         * @return {Promise}      Ajax promise call\n         */\n        SETTINGS_CONTAINER: function(event, name) {\n            var obj = {\n                event: event,\n                name: name\n            };\n            return Templates.render('local_edwiserform/event_settings_container', obj);\n        }\n    };\n\n    /**\n     * Reset form callback\n     */\n    var resetForm = function() {\n        formeo.dom.loading();\n        var formtype = $(SELECTORS.FORMTYPE).val();\n        PROMISES.GET_TEMPLATE(formtype)\n            .done(function(response) {\n                formeo.dom.loadingClose();\n                if (response.status == true) {\n                    formeoOpts.container = container;\n                    // eslint-disable-next-line no-undef\n                    formeo = new Formeo(formeoOpts, response.definition);\n                    $(SELECTORS.EVENT).val().forEach(function(event) {\n                        if (window.eventlist[event].hasOwnProperty('hasRequiredFields') &&\n                            window.eventlist[event].hasRequiredFields()) {\n                            addEventRequiredFields(event);\n                        }\n                    });\n                    return;\n                }\n            }).fail(function(ex) {\n                formeo.dom.loadingClose();\n                formeo.dom.alert('danger', ex.message);\n            });\n    };\n    formeoOpts.resetForm = resetForm;\n    formeoOpts.resetable = $(SELECTORS.FORMTYPE).val() != 'blank';\n\n    /**\n     * Return callback for fastselect library option\n     * @return {Object} Callback object\n     */\n    var fastselectCustomCallbacks = {\n        removeSelectedOption: function(option, $choiceItem) {\n            if (option.value == $(SELECTORS.FORMTYPE).val()) {\n                formeo.dom.toaster(M.util.get_string(\n                    'efb-cannot-remove-event',\n                    SELECTORS.COMPONENT,\n                    $(SELECTORS.FORMTYPE).find('option:selected').html()\n                ), 3000);\n                return;\n            }\n            var removedModel = this.optionsCollection.removeSelected(option);\n            if (removedModel && removedModel.$item) {\n                removedModel.$item.removeClass(this.options.itemSelectedClass);\n            }\n            if ($choiceItem) {\n                $choiceItem.remove();\n            } else {\n                // eslint-disable-next-line no-undef\n                this.$el.find(selectorFromClass(this.options.choiceItemClass) + '[data-value=\"' + option.value + '\"]').remove();\n            }\n            this.updateDomElements();\n            this.writeToInput();\n            $('#efb-event-' + option.value).remove();\n        },\n        setSelectedOption: function(option) {\n            if (this.optionsCollection.isSelected(option.value)) {\n                return;\n            }\n            if (typeof window.eventlist[option.value] == 'undefined') {\n                formeo.dom.alert('danger', M.util.get_string('efb-technical-issue-reload', SELECTORS.COMPONENT), function() {\n                    window.location.reload();\n                });\n                return;\n            }\n            if (window.eventlist[option.value].hasOwnProperty('hasRequiredFields') &&\n                window.eventlist[option.value].hasRequiredFields()) {\n                addEventRequiredFields(option.value);\n            }\n            this.optionsCollection.setSelected(option);\n            var selectedModel = this.optionsCollection.findWhere(function(model) {\n                return model.value === option.value;\n            });\n            if (this.isMultiple) {\n                // eslint-disable-next-line babel/no-unused-expressions\n                this.$controls && this.addChoiceItem(option);\n            } else {\n                // eslint-disable-next-line babel/no-unused-expressions\n                this.fastsearch && this.fastsearch.$resultItems.removeClass(this.options.itemSelectedClass);\n                // eslint-disable-next-line babel/no-unused-expressions\n                this.$toggleBtn && this.$toggleBtn.text(option.text);\n            }\n            // eslint-disable-next-line babel/no-unused-expressions\n            selectedModel && selectedModel.$item.addClass(this.options.itemSelectedClass);\n            this.updateDomElements();\n            // eslint-disable-next-line no-undef\n            pluginhassetting.forEach(function(plugin) {\n                if (option.value == plugin) {\n                    getEventSettings(plugin)\n                        .done(function(response) {\n                            TEMPLATES.SETTINGS_CONTAINER(plugin, option.text)\n                                .done(function(html, js) {\n                                    Templates.appendNodeContents($(SELECTORS.EVENT_LIST), html, js);\n                                    $('#efb-event-' + plugin + ' .efb-event-settings').html(response.settings);\n                                    if (response.status == true && window.eventlist[plugin].hasOwnProperty('init')) {\n                                        window.eventlist[plugin].init();\n                                    }\n                                });\n                        });\n                }\n            });\n        }\n    };\n\n    /**\n     * Check whether form definition is empty or not\n     * @return {Boolean} Return true is definition is empty\n     */\n    function emptyFormDefinition() {\n        let formdef = JSON.parse(getFormDef());\n        return Object.keys(formdef.fields).length == 0;\n    }\n\n    /**\n     * Check whether form preview can be seen and toggle preview button\n     */\n    function canSeePreview() {\n        var emptyform = emptyFormDefinition();\n        $('#efb-form-preview').toggleClass('d-none', emptyform);\n        $('.efb-form-step-preview').toggleClass('d-none', emptyform);\n    }\n\n    /**\n     * Get form definition from formeo object\n     * @return {String} JSON form data\n     */\n    function getFormDef() {\n        return formeo.formData;\n    }\n\n    /**\n     * Check whether admin/teacher can save current form\n     * @return {Boolean} True is admin/teacher can save form\n     */\n    function canSaveForm() {\n        var status = checkTemplate() && checkTitle(false) && !emptyFormDefinition();\n        $('#efb-btn-save-form-settings').parents('.efb-editor-button').toggleClass('d-none', !status);\n        $('.efb-form-save').toggleClass('d-none', !status);\n        return status;\n    }\n\n    /**\n     * Get event settings\n     * @param  {String}  event Event name\n     * @return {Promise}\n     */\n    function getEventSettings(event) {\n        var id = $(\"[name='id']\").val();\n        var promise = PROMISES.GET_EVENT_SETTINGS(event, id != '' ? id : null);\n        promise.fail(function(ex) {\n            formeo.dom.loadingClose();\n            // eslint-disable-next-line no-console\n            console.log(ex);\n        });\n        return promise;\n    }\n\n    /**\n     * Is template is selected or not\n     * @return {Boolean} True is template selected\n     */\n    function checkTemplate() {\n        return $(SELECTORS.TEMPLATES_ROOT).find('.template.active').length > 0;\n    }\n\n    /**\n     * Switch panel using panel id\n     * @param {String} id Panel id\n     */\n    function switchPanel(id) {\n        $(SELECTORS.PANEL).removeClass(SELECTORS.ACTIVE);\n        $('#efb-' + id).addClass(SELECTORS.ACTIVE);\n        $('.efb-tabcontent').removeClass(SELECTORS.ACTIVE);\n        $('#efb-cont-' + id).addClass(SELECTORS.ACTIVE);\n    }\n\n    /**\n     * Check form title\n     * @param  {Boolean} showError If true then error will be shown\n     * @return {Boolean}           If title is not empty then return true\n     */\n    function checkTitle(showError) {\n        if (showError == undefined) {\n            showError = true;\n        }\n        let settings = getFormSettings();\n        var active = $(SELECTORS.PANEL + '.' + SELECTORS.ACTIVE).attr('id');\n        var emptytitle = settings.title != '';\n        if (!showError) {\n            return emptytitle;\n        }\n        if (!emptytitle) {\n            switch (active) {\n                case 'efb-form-setup':\n                case 'efb-form-builder':\n                case 'efb-form-preview':\n                    switchPanel('form-settings');\n                    $(SELECTORS.TITLE).parents('.fitem').addClass('has-danger');\n                    break;\n                case 'efb-form-settings':\n                    switchPanel('form-settings');\n                    $(SELECTORS.TITLE).parents('.fitem').addClass('has-danger');\n                    break;\n            }\n            formeo.dom.toaster(M.util.get_string('efb-lbl-title-warning', SELECTORS.COMPONENT), 3000);\n        } else {\n            $('.efb-form-title-container').removeClass('has-danger');\n            $(SELECTORS.TITLE).parents('.fitem').removeClass('has-danger');\n        }\n        return emptytitle;\n    }\n\n    /**\n     * Toogle event setting on event ribbon click\n     * @param {DOM}     _this        Clicked DOM element\n     * @param {Boolean} collapseOnly True if only one event settings can be uncollapsed\n     */\n    function toggleEventSettings(_this, collapseOnly) {\n        if ($(_this).parent('.efb-event').hasClass('collapsed')) {\n            if (!collapseOnly) {\n                $('.efb-event:not(.collapsed) h4').each(function(i, node) {\n                    $(node).trigger('click', [true]);\n                });\n            }\n            $(_this).parent('.efb-event').removeClass('collapsed');\n            $(_this).next().height('auto');\n            let height = $(_this).next()[0].clientHeight + 'px';\n            $(_this).next().height('0px');\n            setTimeout(function() {\n                $(_this).next().height(height);\n            }, 0);\n        } else {\n            $(_this).next().height('0px');\n            $(_this).next()[0].addEventListener('transitionend', function() {\n                $(_this).parent('.efb-event').addClass('collapsed');\n            }, {\n                once: true\n            });\n        }\n    }\n\n    /**\n     * Add event required fields in the form\n     * @param {String} name Name of template\n     */\n    var addEventRequiredFields = function(name) {\n        PROMISES.GET_TEMPLATE(name).done(function(response) {\n            if (response.status == true) {\n                var formData = JSON.parse(response.definition);\n                Object.keys(formData.fields).forEach(function(field) {\n                    if (formData.fields[field].hasOwnProperty('attrs') &&\n                        formData.fields[field].attrs.hasOwnProperty('required') &&\n                        formData.fields[field].attrs.required &&\n                        formData.fields[field].hasOwnProperty('attrs') &&\n                        formData.fields[field].attrs.hasOwnProperty('name') &&\n                        !formeo.dom.hasFieldWithName(formData.fields[field].attrs.name)\n                    ) {\n                        delete formData.fields[field].attrs.template;\n                        formeo.addMissingField(formData.fields[field]);\n                    }\n                });\n            }\n        }).fail(function(ex) {\n            $('[data-template=\"' + name + '\"]').parents(SELECTORS.TEMPLATE_OVERLAY).removeClass('loading');\n            formeo.dom.alert('danger', ex.message);\n        });\n    };\n\n    /**\n     * Get date from form settings\n     * @param  {String} id Date element id\n     * @return {Number}    Date in unix timestamp format\n     */\n    function getDate(id) {\n        if ($(id + '_enabled').is(':checked')) {\n            let datetime = $(id + '_year').val();\n            datetime += '/' + $(id + '_month').val();\n            datetime += '/' + $(id + '_day').val();\n            datetime += ' ' + $(id + '_hour').val();\n            datetime += ':' + $(id + '_minute').val() + ':00';\n            return (new Date(datetime)).getTime() / 1000;\n        }\n        return 0;\n    }\n\n    /**\n     * Get form settings from Moodle form\n     * @param  {Boolean} getEventsSettings If true then event settings will be returned along with main settings\n     * @return {Object}                    Form settings\n     */\n    function getFormSettings(getEventsSettings = false) {\n        var type = $(SELECTORS.FORMTYPE).val();\n        var selectedevents = $(SELECTORS.EVENT).val();\n        var data = {\n            \"title\": $(SELECTORS.TITLE).val(),\n            \"description\": $(\"#id_description\").val(),\n            \"type\": type,\n            \"events\": selectedevents.join(),\n            \"enable_notifi_email\": $(\"#id_enable_notification\").prop('checked'),\n            \"notifi_email\": $(\"#id_notifi_email\").val(),\n            \"notifi_email_subject\": $(\"#id_notifi_email_subject\").val(),\n            \"notifi_email_body\": $(\"#id_notifi_email_body\").val(),\n            \"emailbodydraftitemid\": $('[name=\"notifi_email_body[itemid]\"]').val(),\n            \"confirmation_subject\": $(\"#id_confirmation_subject\").val(),\n            \"confirmation_message\": $(\"#id_confirmation_msg\").val(),\n            \"msgdraftitemid\": $('[name=\"confirmation_msg[itemid]\"]').val(),\n            \"data_edit\": $(\"#id_editdata\").prop('checked'),\n            \"success_message\": $(\"#id_success_message\").val(),\n            // eslint-disable-next-line no-undef\n            \"style\": selectedStyle,\n            \"allowsubmissionsfromdate\": getDate('#id_allowsubmissionsfromdate'),\n            \"allowsubmissionstodate\": getDate('#id_allowsubmissionstodate'),\n            \"eventsettings\": \"\"\n        };\n        if (getEventsSettings == true) {\n            var eventsettings = {};\n            selectedevents.forEach(function(event) {\n                // eslint-disable-next-line no-undef\n                pluginhassetting.forEach(function(plugin) {\n                    if (event == plugin) {\n                        eventsettings[event] = window.eventlist[event].getSettings();\n                    }\n                });\n            });\n            data.eventsettings = JSON.stringify(eventsettings);\n        }\n        return data;\n    }\n\n    /**\n     * Call ajax service to save form settings\n     * @param {String}   action     Service name\n     * @param {Object}   settings   Form settings\n     * @param {String}   formdef    Form definition\n     * @param {Function} callable   Callback function\n     */\n    function saveFormSettings(action, settings, formdef, callable) {\n        formeo.dom.loading();\n        (action == 'create' ? PROMISES.CREATE_NEW_FORM(settings, formdef) : PROMISES.UPDATE_FORM(settings, formdef))\n        .done(callable).fail(function(ex) {\n            formeo.dom.loadingClose();\n            formeo.dom.alert('danger', ex.message);\n        });\n    }\n\n    /**\n     * Select template using template name and template data\n     * @param {String} formtype Form/template type\n     * @param {String} template Template definition\n     */\n    function selectTemplate(formtype, template = \"\") {\n        formeoOpts.resetable = formtype != 'blank';\n        $(SELECTORS.FORMTYPE).val(formtype);\n\n        // Triggering change event.\n        var changeEvent = new CustomEvent(\"change\", {\n            target: $(SELECTORS.FORMTYPE)[0]\n        });\n        $(SELECTORS.FORMTYPE)[0].dispatchEvent(changeEvent);\n        var events = [];\n        events.push(formtype);\n        $(SELECTORS.EVENT).val(events);\n\n        // Triggering change event.\n        changeEvent = new CustomEvent(\"change\", {\n            target: $(SELECTORS.EVENT)[0]\n        });\n        $(SELECTORS.EVENT)[0].dispatchEvent(changeEvent);\n        fastselect.destroy();\n        fastselect.init($(SELECTORS.EVENT), $(SELECTORS.EVENT).val());\n        initializeTemplate();\n        formeoOpts.container = container;\n        // eslint-disable-next-line no-undef\n        formeo = new Formeo(formeoOpts, template);\n        $(\"#efb-form-settings\").trigger('click');\n    }\n\n    /**\n     * Show template warning if license is not active\n     * @param {DOM} target DOM target template element\n     */\n    function showTargetWarning(target) {\n        formeo.dom.multiActions(\n            'warning',\n            M.util.get_string(\"attention\", SELECTORS.COMPONENT),\n            M.util.get_string(\"efb-template-inactive-license\", SELECTORS.COMPONENT, $(target).data('template-name')), [{\n                title: M.util.get_string('activatelicense', SELECTORS.COMPONENT),\n                type: 'success',\n                action: function() {\n                    window.location.href = M.cfg.wwwroot +\n                        '/admin/settings.php?section=local_edwiserform&activetab=local_edwiserform_license_status';\n                }\n            }, {\n                title: M.util.get_string('cancel', SELECTORS.COMPONENT),\n                type: 'warning'\n            }]\n        );\n    }\n\n    /**\n     * Change heading of top bar\n     * @param {String} formName Form name/title\n     */\n    function changeHeading(formName) {\n        $(\".efb-editor-action\").toggleClass(\"efb-hide\", formName.length < 0);\n        if (formName.length < 0) {\n            $(\"#id_error_template_title\").show();\n        } else {\n            $(\"#id_error_template_title\").hide();\n        }\n        if (formName.length > 33) {\n            formName = formName.substr(0, 30) + '...';\n        }\n        $(\".efb-form-title\").text(formName);\n    }\n\n    /**\n     * Initialize template and events associated with it\n     */\n    function initializeTemplate() {\n        // Initialise event settings.\n        $(SELECTORS.FORMTYPE).closest('.fitem').hide();\n        if ($(SELECTORS.EVENT_LIST).length == 0) {\n            $('#efb-settings-events').append('<div class=\"efb-event-list\"></div>');\n        } else {\n            $(SELECTORS.EVENT_LIST).empty();\n        }\n        let label = $('#id_allowsubmissionsfromdate_enabled').parent();\n        let container = $(label).parent();\n        label.detach().prependTo(container);\n        label = $('#id_allowsubmissionstodate_enabled').parent();\n        container = $(label).parent();\n        label.detach().prependTo(container);\n        $(SELECTORS.EVENT).val().forEach(function(event) {\n            // eslint-disable-next-line no-undef\n            pluginhassetting.forEach(function(plugin) {\n                if (event == plugin) {\n                    getEventSettings(event)\n                        .done(function(response) {\n                            TEMPLATES.SETTINGS_CONTAINER(event, $(SELECTORS.EVENT).find('option[value=\"' + event + '\"]').html())\n                                .done(function(html, js) {\n                                    Templates.appendNodeContents($(SELECTORS.EVENT_LIST), html, js);\n                                    $('#efb-event-' + event + ' .efb-event-settings').html(response.settings);\n                                    if (typeof window.eventlist[event] == 'undefined') {\n                                        formeo.dom.alert(\n                                            'danger',\n                                            M.util.get_string('efb-technical-issue-reload', SELECTORS.COMPONENT),\n                                            function() {\n                                                window.location.reload();\n                                            }\n                                        );\n                                        return;\n                                    }\n                                    if (response.status == true && window.eventlist[event].hasOwnProperty('init')) {\n                                        window.eventlist[event].init();\n                                    }\n                                });\n                        });\n                }\n            });\n        });\n        if (fastselect === null) {\n            fastselect = $(SELECTORS.EVENT).hide().fastselect({\n                callbacks: fastselectCustomCallbacks\n            });\n        }\n    }\n\n    /**\n     * Replace previous template with newly selected template\n     * @param  {DOM} template Currently selected template DOM element\n     */\n    function replaceTemplate(template) {\n        var formtype = $(template).data(\"template\");\n        $(template).parents(SELECTORS.TEMPLATE_OVERLAY).addClass('loading');\n        PROMISES.GET_TEMPLATE(formtype).done(function(response) {\n            $(template).parents(SELECTORS.TEMPLATE_OVERLAY).removeClass('loading');\n            if (response.status == true) {\n                selectTemplate(formtype, response.definition);\n                return;\n            }\n            if (response.msg != 'license-inactive') {\n                formeo.dom.alert('warning', response.msg, function() {\n                    selectTemplate(formtype, response.definition);\n                });\n            }\n            showTargetWarning(template);\n        }).fail(function(ex) {\n            $(template).parents(SELECTORS.TEMPLATE_OVERLAY).removeClass('loading');\n            formeo.dom.alert('danger', ex.message);\n        });\n    }\n\n    /**\n     * Action to be performed after creating form\n     * @param  {Object} response Ajax response\n     */\n    var formCreateAction = function(response) {\n        formeo.dom.loadingClose();\n        if (response.status == true) {\n            window.onbeforeunload = null;\n            saved = true;\n            response.formname = $(SELECTORS.TITLE).val();\n            // eslint-disable-next-line no-undef, camelcase\n            if (mod_edwiserform_return != undefined && mod_edwiserform_return == true) {\n                window.opener.local_edwiserform_add_new_form(response);\n                return;\n            }\n            formeo.dom.alert('success', response.msg, function() {\n                formeo.reset();\n                $(location).attr('href', M.cfg.wwwroot + \"/local/edwiserform/view.php?page=listforms\");\n            });\n            setTimeout(function() {\n                $(location).attr('href', M.cfg.wwwroot + \"/local/edwiserform/view.php?page=listforms\");\n            }, 4000);\n        } else {\n            formeo.dom.alert('danger', response.msg);\n        }\n    };\n\n    /**\n     * Action to be performed after updating form\n     * @param  {Object} response Ajax response\n     */\n    var formUpdateAction = function(response) {\n        formeo.dom.loadingClose();\n        if (response.status == CONSTANTS.FORM_UPDATE) {\n            window.onbeforeunload = null;\n            response.formname = $(SELECTORS.TITLE).val();\n            // eslint-disable-next-line no-undef, camelcase\n            if (mod_edwiserform_return != undefined && mod_edwiserform_return == true) {\n                window.opener.local_edwiserform_edit_form(response);\n                return;\n            }\n            formeo.dom.multiActions(\n                'success',\n                M.util.get_string(\"success\", SELECTORS.COMPONENT),\n                response.msg, [{\n                    title: M.util.get_string(\"efb-heading-listforms\", SELECTORS.COMPONENT),\n                    type: 'primary',\n                    action: function() {\n                        $(location).attr('href', M.cfg.wwwroot + \"/local/edwiserform/view.php?page=listforms\");\n                    }\n                }, {\n                    title: M.util.get_string(\"close\", SELECTORS.COMPONENT),\n                    type: 'default'\n                }]\n            );\n        } else if (response.status == CONSTANTS.FORM_OVERITE) {\n            var action = \"update\";\n            var formdef = getFormDef();\n            var settings = getFormSettings(true);\n            settings.forceupdate = true;\n            settings.id = $(\"[name='id']\").val();\n            formeo.dom.multiActions(\n                'warning',\n                M.util.get_string(\"attention\", SELECTORS.COMPONENT),\n                response.msg, [{\n                    title: M.util.get_string(\"proceed\", SELECTORS.COMPONENT),\n                    type: 'warning',\n                    action: function() {\n                        saveFormSettings(action, settings, formdef, formUpdateAction);\n                    }\n                }, {\n                    title: M.util.get_string(\"cancel\", SELECTORS.COMPONENT),\n                    type: 'success'\n                }]\n            );\n        } else {\n            formeo.dom.alert('danger', response.msg);\n        }\n    };\n\n    /**\n     * Innitialize form events\n     */\n    function initializeEvents() {\n        $('.efb-form-style-container .controls-toggle').click(function() {\n            $(this).parents('.preview-form').toggleClass('show-styles');\n            $('#efb-cont-form-builder .formeo-controls').closest('.build-form').toggleClass('hidden-controls');\n        });\n        $(SELECTORS.FORM_STYLE).mouseenter(function() {\n            $('.form-style-preview').attr('src', $(this).find('img').attr('src')).css('top', $(this).offset().top).show();\n        }).mouseleave(SELECTORS.FORM_STYLE, function() {\n            $('.form-style-preview').attr('src', '').hide();\n        }).click(SELECTORS.FORM_STYLE, function() {\n            $(SELECTORS.FORM_STYLE).removeClass('selected');\n            $(this).addClass('selected');\n            // eslint-disable-next-line no-undef\n            for (var i = 1; i <= supportedStyles; i++) {\n                if ($(SELECTORS.RENDER_FORM).hasClass('form-style-' + i)) {\n                    formStyles.apply($(SELECTORS.RENDER_FORM), 'remove', i);\n                }\n            }\n            // eslint-disable-next-line no-undef\n            selectedStyle = $(this).data('form');\n            formStyles.apply($(SELECTORS.RENDER_FORM), 'add', $(this).data('form'));\n        });\n        $('.efb-settings-tab-list-item').click(function() {\n            // eslint-disable-next-line no-undef\n            if (license != 'available' && $(this).data('target') == 'efb-settings-events') {\n                formeo.dom.multiActions(\n                    'warning',\n                    M.util.get_string(\"attention\", SELECTORS.COMPONENT),\n                    M.util.get_string(\"efb-template-inactive-license\", SELECTORS.COMPONENT, $(this).find('h4').text()), [{\n                        title: M.util.get_string('activatelicense', SELECTORS.COMPONENT),\n                        type: 'success',\n                        action: function() {\n                            window.location.href = M.cfg.wwwroot +\n                                '/admin/settings.php?section=local_edwiserform&activetab=local_edwiserform_license_status';\n                        }\n                    }, {\n                        title: M.util.get_string('cancel', SELECTORS.COMPONENT),\n                        type: 'warning'\n                    }]\n                );\n                return;\n            }\n            $('.efb-settings-tab-list-item').removeClass('active');\n            $(this).addClass('active');\n            $('.efb-settings-tab').removeClass('active');\n            $('#' + $(this).data('target')).addClass('active');\n        });\n        $('.step-navigation #previous-step').click(function() {\n            return;\n        });\n        $('.step-navigation #next-step').click(function() {\n            return;\n        });\n        $(document).on('formeoUpdated', function() {\n            var status = canSaveForm();\n            canSeePreview();\n            if (!status) {\n                $(SELECTORS.EVENT).val().forEach(function(event) {\n                    if (window.eventlist[event].hasOwnProperty('hasRequiredFields') &&\n                        window.eventlist[event].hasRequiredFields()) {\n                        addEventRequiredFields(event);\n                    }\n                });\n            }\n            formeo.dom.toggleImportButton();\n        });\n\n        $(\".efb-form-step\").click(function(event) {\n            event.preventDefault();\n            var id = $(this).data('id');\n            $('#' + id).click();\n        });\n        $(SELECTORS.PANEL).click(function(event) {\n            if (!checkTemplate()) {\n                formeo.dom.toaster(M.util.get_string('efb-select-template-warning', SELECTORS.COMPONENT), 3000);\n                switchPanel('form-setup');\n                event.preventDefault();\n                return;\n            }\n            var id = $(this).attr('id');\n            if (id != 'efb-form-setup' && id != 'efb-form-settings' && !checkTitle()) {\n                event.preventDefault();\n                return;\n            }\n            canSaveForm();\n            var eleCont = $(this).data(\"panel\");\n            $(\"#efb-form-settings, #efb-form-builder, #efb-form-preview, #efb-form-setup\").removeClass(SELECTORS.ACTIVE);\n            $(\"#efb-cont-form-settings, #efb-cont-form-builder, #efb-cont-form-preview, #efb-cont-form-setup\")\n                .removeClass(SELECTORS.ACTIVE);\n\n            $(eleCont).addClass(SELECTORS.ACTIVE);\n            $(this).addClass(SELECTORS.ACTIVE);\n            $(\".efb-forms-panel-heading\").text($(this).data(\"panel-lbl\"));\n\n            if (\"#efb-cont-form-preview\" == eleCont) {\n                formeo.render(renderContainer);\n                // eslint-disable-next-line no-undef\n                for (var i = 1; i <= supportedStyles; i++) {\n                    if ($(SELECTORS.RENDER_FORM).hasClass('form-style-' + i)) {\n                        formStyles.apply($(SELECTORS.RENDER_FORM), 'remove', i);\n                    }\n                }\n                // eslint-disable-next-line no-undef\n                formStyles.apply($(SELECTORS.RENDER_FORM), 'add', selectedStyle);\n            }\n        });\n\n        $('body').on('click', '.efb-event-label', function(event, collapseOnly = null) {\n                if ($(this).next().html() == '') {\n                    return;\n                }\n                toggleEventSettings(this, collapseOnly);\n            })\n            // Copy email tag.\n            .on('click', '.efb-email-tag', function() {\n                var temp = $('<input>');\n                $('body').append(temp);\n                var shortcode = $(this).text();\n                temp.val(shortcode).select();\n                document.execCommand('copy');\n                temp.remove();\n                formeo.dom.toaster(M.util.get_string('shortcodecopied', SELECTORS.COMPONENT, shortcode), 3000);\n            })\n            // This will save the form settings using ajax.\n            .on(\"click\", \"#efb-btn-save-form-settings\", function(event) {\n                if (!checkTemplate()) {\n                    formeo.dom.toaster(M.util.get_string('efb-select-template-warning', SELECTORS.COMPONENT), 3000);\n                    switchPanel('form-setup');\n                    event.preventDefault();\n                    return;\n                }\n                if (!checkTitle() || !formeo.validator.validate()) {\n                    return;\n                }\n                var settings = getFormSettings(true);\n                if (settings.allowsubmissionsfromdate >= settings.allowsubmissionstodate && settings.allowsubmissionstodate != 0) {\n                    $('#id_allowsubmissionstodate_calendar').parent('.fdate_time_selector').next().show()\n                        .text(M.util.get_string('allowsubmissionscollapseddate', SELECTORS.COMPONENT))\n                        .parents('.form-group.row.fitem').addClass('has-danger');\n                    return;\n                } else {\n                    $('#id_allowsubmissionstodate_calendar').parent('.fdate_time_selector').next().show()\n                        .text('').parents('.form-group.row.fitem').removeClass('has-danger');\n                }\n                var formdef = getFormDef();\n                var formid = $(\"[name='id']\").val();\n                var action = \"create\";\n                if (formid) {\n                    formeo.dom.multiActions(\n                        'warning',\n                        M.util.get_string(\"attention\", SELECTORS.COMPONENT),\n                        M.util.get_string(\"efb-forms-update-confirm\", SELECTORS.COMPONENT), [{\n                            title: M.util.get_string(\"efb-forms-update-create-new\", SELECTORS.COMPONENT),\n                            type: 'primary',\n                            action: function() {\n                                saveFormSettings(action, settings, formdef, formCreateAction);\n                            }\n                        }, {\n                            title: M.util.get_string(\"efb-forms-update-overwrite-existing\", SELECTORS.COMPONENT),\n                            type: 'warning',\n                            action: function() {\n                                action = \"update\";\n                                settings.id = formid;\n                                saveFormSettings(action, settings, formdef, formUpdateAction);\n                            }\n                        }]\n                    );\n                    return;\n                }\n                if (!saved) {\n                    saveFormSettings(action, settings, formdef, formCreateAction);\n                } else {\n                    formeo.dom.toaster(M.util.get_string('efb-form-setting-saved', SELECTORS.COMPONENT), 3000);\n                }\n            });\n\n        $(SELECTORS.FORM_TITLE).keyup(function() {\n            var formName = $(this).val();\n            var empty = formName == '';\n            $(this).parent().toggleClass('has-danger', empty);\n            $(SELECTORS.TITLE).val(formName);\n            changeHeading(formName);\n        }).change(function() {\n            canSaveForm();\n        });\n        $(SELECTORS.TITLE).keyup(function() {\n            var formName = $(this).val();\n            $(SELECTORS.TITLE).val(formName);\n            changeHeading(formName);\n        }).change(function() {\n            var formName = $(this).val();\n            $(SELECTORS.FORM_TITLE).val(formName);\n            canSaveForm();\n        });\n\n        $(SELECTORS.FORMTYPE).change(function() {\n            $(SELECTORS.TEMPLATES_ROOT).find(\".template\").removeClass(\"active\");\n            var type = $(this).val();\n            $(SELECTORS.TEMPLATES_ROOT).find(\"#template-\" + type).addClass(\"active\");\n            $('#id_registration-enabled').prop('checked', true);\n        });\n        $(SELECTORS.TEMPLATES_ROOT).find(\".template-select\").click(function() {\n            var _this = this;\n            // eslint-disable-next-line no-undef\n            if ($(this).data('pro') == true && license != 'available') {\n                showTargetWarning(this);\n                return;\n            }\n            canSaveForm();\n            if ($(SELECTORS.TEMPLATES_ROOT).find(\".template.active\").length && !emptyFormDefinition()) {\n                formeo.dom.multiActions(\n                    'warning',\n                    M.util.get_string(\"attention\", SELECTORS.COMPONENT),\n                    M.util.get_string(\"efb-template-change-warning\", SELECTORS.COMPONENT), [{\n                        title: M.util.get_string('proceed', SELECTORS.COMPONENT),\n                        type: 'warning',\n                        action: function() {\n                            replaceTemplate(_this);\n                        }\n                    }, {\n                        title: M.util.get_string('cancel', SELECTORS.COMPONENT),\n                        type: 'success'\n                    }]\n                );\n            } else {\n                replaceTemplate(_this);\n            }\n        });\n        $(document).on('formeoLoaded', function() {\n            canSeePreview();\n        });\n        document.addEventListener('eventsLoaded', function() {\n            initializeTemplate();\n            canSaveForm();\n            formeo.dom.loadingClose();\n        });\n    }\n\n    /**\n     * Load all plugin js which support form settings to use further\n     */\n    function loadPluginJs() {\n        let loaded = 0;\n        var allevents = $(SELECTORS.EVENT).find('option').map(function(index, event) {\n            return event.value;\n        });\n        if (allevents.length > 0) {\n            allevents.each(function(index, plugin) {\n                require(['edwiserformevents_' + plugin + '/settings'], function(eventjs) {\n                    window.eventlist[plugin] = eventjs;\n                    if (allevents.length == ++loaded) {\n                        $('.efb-form-builder-wrap').show();\n                        initializeEvents();\n                        document.dispatchEvent(eventsLoaded);\n                    }\n                });\n            });\n            return;\n        }\n        initializeEvents();\n        $('.efb-form-builder-wrap').show();\n    }\n\n    /**\n     * Main method which call when this js is loaded\n     * @param {String} sitekey Google recaptcha Site key\n     */\n    var init = function(sitekey) {\n        $(document).ready(function() {\n            formeoOpts.sitekey = sitekey;\n            if (typeof formdefinition != 'undefined') {\n                // eslint-disable-next-line no-undef\n                formeo = new Formeo(formeoOpts, formdefinition);\n            } else {\n                // eslint-disable-next-line no-undef\n                formeo = new Formeo(formeoOpts);\n            }\n            canSeePreview();\n            $('#root-page-loading').hide();\n            formeo.dom.loading();\n            loadPluginJs();\n        });\n    };\n    return {\n        init: init\n    };\n});"],"file":"new_form_main.min.js"}