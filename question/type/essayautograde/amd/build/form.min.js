/**
 * javascript for Essay (autograde) edit form
 *
 * @module      qtype_essayautograde/form
 * @category    output
 * @copyright   2018 Gordon Bateson (gordon.bateson@gmail.com)
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since       Moodle 3.0
 */
define("qtype_essayautograde/form",["jquery"],(function($){var JS={};return JS.sizewidths=new Array,JS.init=function(){JS.init_responseformat(),JS.init_target_phrases(),JS.init_add_button("addbands","id_gradebands"),JS.init_add_button("addphrases","id_targetphrases")},JS.init_responseformat=function(){var fmt=document.querySelector("select[name=responseformat]");$(fmt).change((function(){var fmtvalue=this.options[this.selectedIndex].value,fmttext=this.options[this.selectedIndex].innerText,fmtnumber=0;"plain"==fmtvalue||"monospaced"==fmtvalue?fmtnumber=2:"editor"!=fmtvalue&&"editorfilepicker"!=fmtvalue||(fmtnumber=1),new Array("responsetemplate","responsesample").forEach((function(name){var fmt=document.querySelector("[name='"+name+"[format]']");if(fmt)if(fmt.matches("select"))for(var i=0;i<fmt.options.length;i++)fmt.options[i].value==fmtnumber&&(fmt.options[i].selected=!0);else fmt.matches("input[type=hidden]")&&(fmt.value=fmtnumber);var txt=document.querySelector("[name='"+name+"[text]']");if(txt){var elm,editor=null,editable=null;if((elm=txt.previousElementSibling)&&elm.matches(".editor_atto")&&(editable=(editor=elm).querySelector("#id_"+name+"editable")),(elm=txt.nextElementSibling)&&elm.matches("#id_"+name+"_parent")&&(elm=(editor=elm).querySelector("#id_"+name+"_ifr"))&&((elm=elm.contentWindow||elm.contentDocument).document&&(elm=elm.document),editable=elm.body),editor){0==fmtnumber||1==fmtnumber?(txt.hidden=!0,txt.style.display="none"):(txt.hidden=!1,txt.style.display="",editable&&(txt.value=editable.innerText)),0==fmtnumber||2==fmtnumber?(editor.hidden=!0,editor.style.display="none",(elm=editor.parentNode.querySelector(".editor_atto_notification"))&&(elm.hidden=!0,elm.style.display="none")):(editor.hidden=!1,editor.style.display="",editable&&(editable.innerHTML=txt.value));var msg=txt.parentNode.querySelector("#noinline-message");0==fmtnumber?msg?(msg.hidden=!1,msg.style.display=""):((msg=document.createElement("DIV")).setAttribute("id","noinline-message"),msg.appendChild(document.createTextNode(fmttext)),txt.parentNode.appendChild(msg)):msg&&(msg.hidden=!0,msg.style.display="none")}}}))}))},JS.init_target_phrases=function(){$("input[id^=id_phrasematch_]").each((function(){$(this).keyup((function(){var sizewidth=0,size=$(this).attr("size");if(size)if(size in JS.sizewidths)sizewidth=JS.sizewidths[size];else{var elm=document.createElement("INPUT");$(elm).attr("size",size),$(elm).css("width","auto"),$(elm).hide().appendTo("BODY"),sizewidth=$(elm).outerWidth(),$(elm).remove(),JS.sizewidths[size]=sizewidth}var txt=document.createTextNode($(this).val());elm=document.createElement("SPAN");$(elm).append(txt).hide().appendTo("BODY");var w=Math.max($(elm).width(),sizewidth);$(elm).remove(),$(this).width(w)})),$(this).triggerHandler("keyup")}))},JS.init_add_button=function(name,anchor){$("input[name="+name+"]").click((function(){var url=$(this).closest("form").prop("action");url=url.replace(new RegExp("#.*$"),""),$(this).closest("form").prop("action",url+"#"+anchor)}))},JS}));

//# sourceMappingURL=form.min.js.map