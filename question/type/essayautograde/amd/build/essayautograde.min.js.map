{"version":3,"file":"essayautograde.min.js","sources":["../src/essayautograde.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the term of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * load the Essay (auto-grade) question\n *\n * @module      qtype_essayautograde/view\n * @category    output\n * @copyright   2018 Gordon Bateson (gordon.bateson@gmail.com)\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since       Moodle 3.0\n */\ndefine([\"jquery\", \"core/str\"], function($, STR) {\n\n    /** @alias module:qtype_essayautograde/view */\n    var JS = {};\n\n    // cache the plugin name and string cache\n    JS.plugin = \"qtype_essayautograde\";\n    JS.str = {};\n\n    JS.itemtype = \"\";\n    JS.itemsplit = \"\";\n\n    JS.minitems = 0;\n    JS.maxitems = 0;\n\n    JS.editortype = \"\";\n\n    JS.editormaxtries = 50;\n    JS.editorinterval = 100; // 100 ms\n\n    JS.responsesample = \"\";\n    JS.responseoriginal = \"\";\n\n    /*\n     * initialize this AMD module\n     */\n    JS.init = function(readonly, itemtype, minitems, maxitems, editortype, responsesample) {\n\n        // get RegExp expression for this item type\n        var itemsplit = \"\";\n        switch (itemtype) {\n            case \"chars\": itemsplit = \"\"; break;\n            case \"words\": itemsplit = \"[\\\\s—–]+\"; break;\n            case \"sentences\": itemsplit = \"[\\\\.?!]+\"; break;\n            case \"paragraphs\": itemsplit = \"[\\\\r\\\\n]+\"; break;\n        }\n        // take a look at https://github.com/RadLikeWhoa/Countable/blob/master/Countable.js\n        // for more ideas on how to count chars, words, sentences, and paragraphs\n\n        JS.itemtype = itemtype;\n        JS.itemsplit = new RegExp(itemsplit);\n\n        JS.minitems = minitems;\n        JS.maxitems = maxitems;\n\n        JS.editortype = editortype;\n\n        if (readonly) {\n            JS.setup_read_only_files();\n            JS.setup_response_heights();\n        } else {\n            JS.setup_itemcounts();\n            JS.setup_responsesample(responsesample);\n        }\n    };\n\n    JS.setup_read_only_files = function() {\n       STR.get_strings([\n            {\"key\": \"rotate\",   \"component\": JS.plugin},\n            {\"key\": \"scale\",    \"component\": JS.plugin},\n            {\"key\": \"overflow\", \"component\": JS.plugin},\n            {\"key\": \"auto\",     \"component\": JS.plugin},\n            {\"key\": \"hidden\",   \"component\": JS.plugin},\n            {\"key\": \"visible\",  \"component\": JS.plugin},\n            {\"key\": \"actions\",  \"component\": \"moodle\"},\n            {\"key\": \"crop\",     \"component\": JS.plugin},\n            {\"key\": \"reset\",    \"component\": \"moodle\"},\n            {\"key\": \"save\",     \"component\": \"moodle\"}\n        ]).done(function(s){\n            var i = 0;\n            JS.str.rotate   = s[i++];\n            JS.str.scale    = s[i++];\n            JS.str.overflow = s[i++];\n            JS.str.auto     = s[i++];\n            JS.str.hidden   = s[i++];\n            JS.str.visible  = s[i++];\n            JS.str.actions  = s[i++];\n            JS.str.crop     = s[i++];\n            JS.str.reset    = s[i++];\n            JS.str.save     = s[i++];\n\n            document.querySelectorAll(\".attachments .read-only-file.image .img-responsive\").forEach(function(img){\n                if (img.dataset.buttons_added) {\n                    return true;\n                }\n                img.dataset.buttons_added = true;\n\n                // remove border, margin and padding from img\n                img.classList.add(\"border-0\");\n                img.classList.add(\"m-0\");\n                img.classList.add(\"p-0\");\n\n                // Create a container DIV for the image\n                var container = document.createElement(\"DIV\");\n                container.classList.add(\"border-0\");\n                container.classList.add(\"m-0\");\n                container.classList.add(\"p-0\");\n                container.classList.add(\"position-relative\");\n                container.classList.add(\"image-container\");\n\n                // Insert the container DIV into the document\n                // and move the image into the container.\n                img.parentNode.insertBefore(container, img);\n                container.appendChild(img);\n\n                // Set transition duration now, so that all\n                // transform() transitions are smooth.\n                img.style.transitionDuration = \"1s\";\n                container.style.transitionDuration = \"1s\";\n\n                if (img.complete) {\n                    JS.set_image_dimensions(img, container);\n                } else {\n                    img.onload = function(){\n                        JS.set_image_dimensions(this, this.parentNode);\n                    };\n                }\n\n                // Create <div> for all buttonsets\n                var buttonsets = document.createElement(\"DIV\");\n                buttonsets.classList.add(\"border-0\");\n                buttonsets.classList.add(\"m-0\");\n                buttonsets.classList.add(\"p-0\");\n                buttonsets.classList.add(\"buttonsets\");\n\n                // Create <div> for overflow buttonset\n                var type = \"overflow\";\n                var label = JS.str[type];\n                var buttonset = new Array();\n                var values = new Array(\"visible\", \"auto\", \"hidden\");\n                for (var i in values) {\n                    var value = values[i];\n                    var txt = JS.str[value];\n                    var dataset = {\"value\": value};\n                    buttonset.push(JS.create_button(type, txt, dataset, JS.transform_image));\n                }\n\n                // Add overflow buttonset to the buttonsets DIV\n                buttonsets.appendChild(JS.create_buttonset(type, label, buttonset));\n\n                // Create <div> for rotate buttonset\n                var type = \"rotate\";\n                var label = JS.str[type];\n                var buttonset = new Array();\n                var values = new Array(0, 90, 180, 270);\n                for (var i in values) {\n                    var value = values[i];\n                    var txt = value + \"\\u00B0\";\n                    // \"\\u00B0\" is a degrees symbol: °\n                    var dataset = {\"value\": value};\n                    buttonset.push(JS.create_button(type, txt, dataset, JS.transform_image));\n                }\n\n                // Add rotate buttonset to the buttonsets DIV\n                buttonsets.appendChild(JS.create_buttonset(type, label, buttonset));\n\n                // Create <div> for scale buttonset\n                var type = \"scale\";\n                var label = JS.str[type];\n                var buttonset = new Array();\n                var values = new Array(0.5, 1, 1.5, 2);\n                for (var i in values) {\n                    var value = values[i];\n                    var txt = \"\\u00D7\" + value;\n                    // \"\\u00D7\" is a multiplication sign: ×\n                    var dataset = {\"value\": value};\n                    buttonset.push(JS.create_button(type, txt, dataset, JS.transform_image));\n                }\n\n                // Add scale buttonset to the buttonsets DIV\n                buttonsets.appendChild(JS.create_buttonset(type, label, buttonset));\n\n                // Create <div> for actions buttonset\n                //var type = \"actions\";\n                //var label = JS.str[type];\n                //var buttonset = new Array();\n                //var values = new Array(\"crop\", \"reset\", \"save\");\n                //for (var i in values) {\n                //    var value = values[i];\n                //    var txt = JS.str[value];\n                //    var dataset = {\"value\": value};\n                //    buttonset.push(JS.create_button(type, txt, dataset, JS.transform_image));\n                //}\n\n                // Add actions buttonset to the buttonsets DIV\n                //buttonsets.appendChild(JS.create_buttonset(type, label, buttonset));\n\n                // Insert buttonsets after the IMG container\n                container.parentNode.insertBefore(buttonsets, container.nextElementSibling);\n            });\n        });\n    };\n\n    JS.set_image_dimensions = function(img, container) {\n\n        // cache original height and width of img\n        img.dataset.width = img.offsetWidth;\n        img.dataset.height = img.offsetHeight;\n        img.dataset.offset = (img.offsetWidth - img.offsetHeight);\n        img.dataset.ratio = (img.offsetWidth / img.offsetHeight);\n\n        // cache original height and width of container\n        container.dataset.width = container.offsetWidth;\n        container.dataset.height = container.offsetHeight;\n\n        // Set the initial height and width of the img container so that\n        // it doesn't collapse when we set the img to absolute positioning.\n        container.style.height = container.dataset.height+ \"px\";\n        container.style.width = container.dataset.width + \"px\";\n        img.style.position = \"absolute\";\n\n        img.setAttribute(\"draggable\", \"true\");\n        img.addEventListener(\"dragstart\", JS.image_dragstart, false);\n        img.addEventListener(\"drag\", JS.image_drag, false);\n        img.addEventListener(\"dragend\", JS.image_dragend, false);\n    };\n\n    JS.image_dragstart = function(evt) {\n        this.style.transitionDuration = \"0s\";\n        // Cache the current coordinates of the mouse and image.\n        this.dataset.evtPageY = evt.pageY;\n        this.dataset.evtPageX = evt.pageX;\n        this.dataset.imgOffsetTop = this.offsetTop;\n        this.dataset.imgOffsetLeft = this.offsetLeft;\n    };\n\n    JS.image_drag = function(evt) {\n        if (evt.pageX && evt.pageY) {\n            // Move the image by the same amount as the mouse\n            // has moved from its original position\n            var offsetY = (evt.pageY - this.dataset.evtPageY);\n            var offsetX = (evt.pageX - this.dataset.evtPageX);\n            var offsetTop = parseInt(this.dataset.imgOffsetTop);\n            var offsetLeft = parseInt(this.dataset.imgOffsetLeft);\n            this.style.top = (offsetTop + offsetY) + \"px\";\n            this.style.left = (offsetLeft + offsetX) + \"px\";\n        }\n    };\n\n    JS.image_dragend = function(evt) {\n        this.style.transitionDuration = \"1s\";\n        if (evt.preventDefault) {\n            evt.preventDefault();\n        }\n        if (evt.stopPropagation) {\n            evt.stopPropagation();\n        }\n        return false;\n    };\n\n    JS.create_buttonset = function(type, txt, buttons) {\n        var buttonset = document.createElement(\"DIV\");\n        buttonset.classList.add(\"bg-secondary\");\n        buttonset.classList.add(\"rounded\");\n        buttonset.classList.add(\"mt-1\");\n        buttonset.classList.add(\"pl-1\");\n        buttonset.classList.add(\"buttonset\");\n        if (type) {\n            buttonset.classList.add(type + \"-buttonset\");\n        }\n        if (txt) {\n            var span = document.createElement(\"SPAN\");\n            span.classList.add(\"font-weight-bold\");\n            span.appendChild(document.createTextNode(txt + \":\"));\n            buttonset.appendChild(span);\n        }\n        if (buttons) {\n            for (var i in buttons) {\n                buttonset.appendChild(buttons[i]);\n            }\n        }\n        return buttonset;\n    };\n\n    JS.create_button = function(type, txt, dataset, fn) {\n        var button = document.createElement(\"BUTTON\");\n        button.setAttribute(\"type\", \"button\");\n        button.classList.add(\"button\");\n        button.classList.add(\"button-light\");\n        button.classList.add(\"border\");\n        button.classList.add(\"rounded\");\n        button.classList.add(\"my-1\");\n        button.classList.add(\"ml-1\");\n        button.classList.add(\"mr-0\");\n        button.classList.add(\"px-2\");\n        if (type) {\n            button.classList.add(type + \"-button\");\n        }\n        if (txt) {\n            button.appendChild(document.createTextNode(txt));\n        }\n        if (dataset) {\n            for (var name in dataset) {\n                button.dataset[name] = dataset[name];\n            }\n        }\n        if (fn) {\n            button.addEventListener(\"click\", fn, false);\n        }\n        return button;\n    };\n\n    JS.transform_image = function() {\n        var buttonset = this.parentNode;\n        if (! buttonset.matches(\".buttonset\")) {\n            return false;\n        }\n\n       // Deselect ALL buttons in this buttonset\n        buttonset.querySelectorAll(\".btn-info\").forEach(function(button){\n            JS.deselect_button(button);\n        });\n\n        // Select (=highlight) this button.\n        JS.select_button(this);\n\n        // locate buttonsets\n        var buttonsets = buttonset.parentNode;\n        if (! buttonsets.matches(\".buttonsets\")) {\n            return false;\n        }\n\n        // locate image container\n        var container = buttonsets.previousElementSibling;\n        if (! container.matches(\".image-container\")) {\n            return false;\n        }\n\n        // locate image\n        var img = container.querySelector(\"img\");\n        if (! img) {\n            return false;\n        }\n\n        var reset = (this.dataset.value == \"reset\");\n\n        var overflow = \"visible\"; // default value of overflow\n        var button = buttonsets.querySelector('.overflow-buttonset .btn-info');\n        if (button) {\n            if (reset) {\n                button = JS.set_default_button(button, \"overflow\", overflow);\n            }\n            overflow = button.dataset.value;\n        }\n\n        var rotate_angle = 0;\n        var button = buttonsets.querySelector('.rotate-buttonset .btn-info');\n        if (button) {\n            if (reset) {\n                button = JS.set_default_button(button, \"rotate\", rotate_angle);\n            }\n            rotate_angle = button.dataset.value;\n        }\n\n        var scale_factor = 1;\n        var button = buttonsets.querySelector('.scale-buttonset .btn-info');\n        if (button) {\n            if (reset) {\n                button = JS.set_default_button(button, \"scale\", scale_factor);\n            }\n            scale_factor = button.dataset.value;\n        }\n\n        var t = img.style.transform;\n        t = t.replace(new RegExp(\" *(rotate|scale|translate) *\\\\([^)]*\\\\)\", \"g\"), \"\");\n        if (rotate_angle) {\n            t += \" rotate(\" + rotate_angle + \"deg)\";\n        }\n\n        if (rotate_angle == 90 || rotate_angle ==  270) {\n            if (overflow == \"visible\") {\n                scale_factor *= img.dataset.ratio;\n            }\n            var offset = (img.dataset.offset * scale_factor);\n            if (rotate_angle == 270) {\n                offset = (-offset);\n            }\n            t += \" translate(\" + (offset/2) + \"px, \" + (offset/2) + \"px)\";\n        }\n\n        img.style.transform = t.trim();\n        img.style.maxWidth = \"initial\"; // override \"100%\"\n        img.style.width = (img.dataset.width * scale_factor) + \"px\";\n\n        var h = 0;\n        if (rotate_angle == 90 || rotate_angle ==  270) {\n            h = container.dataset.width;\n        } else {\n            h = container.dataset.height;\n        }\n        if (overflow == \"visible\" || scale_factor < 1) {\n            h *= scale_factor;\n        }\n\n        container.style.overflow = overflow;\n        container.style.height = h + \"px\";\n\n        if (reset) {\n            // deselect the RESET button\n            JS.deselect_button(this);\n        }\n\n    };\n\n    JS.select_button = function(button){\n        button.classList.remove(\"btn-light\");\n        button.classList.add(\"btn-info\");\n    };\n\n    JS.deselect_button = function(button){\n        button.classList.remove(\"btn-info\");\n        button.classList.add(\"btn-light\");\n    };\n\n    JS.set_default_button = function(button, type, value){\n        if (button.dataset.value == value) {\n            return button; // nothing to do\n        }\n\n        // Deselect the currently selected button.\n        JS.deselect_button(button);\n\n        // Locate and highlight the default button.\n        button = button.parentNode.querySelector('.' + type + '-button[data-value=\"' + value + '\"]');\n        if (button) {\n            button.classList.remove(\"btn-light\");\n            button.classList.add(\"btn-info\");\n        }\n\n        // Return default button\n        return button;\n    };\n\n    JS.setup_response_heights = function() {\n       $(\"textarea.qtype_essay_response\").each(function(){\n           $(this).height(1);\n           $(this).height(this.scrollHeight);\n       });\n    };\n\n    JS.setup_itemcounts = function() {\n        STR.get_strings([\n            {\"key\": \"maxwordswarning\", \"component\": JS.plugin},\n            {\"key\": \"minwordswarning\", \"component\": JS.plugin},\n        ]).done(function(s){\n            var i = 0;\n            JS.str.maxwordswarning = s[i++];\n            JS.str.minwordswarning = s[i++];\n\n            $(\".qtype_essay_response\").each(function(){\n                var id = JS.get_itemcount_id(this);\n                var editorloaded = $.Deferred();\n                JS.check_editor(this, editorloaded);\n                $.when(editorloaded).done($.proxy(function(){\n                    JS.setup_itemcount(this, id);\n                }, this, id));\n            });\n        });\n    };\n\n    JS.check_editor = function(response, editorloaded) {\n        var selector = \"\";\n        switch (JS.editortype) {\n            case \"atto\": selector = \"[contenteditable=true]\"; break;\n            case \"tinymce\": selector = \"iframe\"; break;\n        }\n        if (selector==\"\") {\n            // textarea - or unknown !!\n            editorloaded.resolve();\n        } else {\n            var editorchecker = setInterval(function() {\n                if ($(response).find(selector).length) {\n                    clearInterval(editorchecker);\n                    editorloaded.resolve();\n                }\n            }, JS.editorinterval);\n        }\n    };\n\n    JS.setup_itemcount = function(response, id) {\n        var editable = JS.get_editable_element(response);\n        if (editable) {\n            $(editable).keyup(function(){\n                JS.show_itemcount(this, id);\n            });\n            JS.show_itemcount(editable, id);\n        }\n    };\n\n    JS.get_editable_element = function(response) {\n        // search for plain text editor\n        if ($(response).prop(\"tagName\")==\"TEXTAREA\") {\n            return response;\n        }\n        // search for Atto editor\n        var editable = $(response).find(\"[contenteditable=true]\");\n        if (editable.length) {\n            return editable.get(0);\n        }\n        // search for MCE editor\n        var i = response.getElementsByTagName(\"IFRAME\");\n        if (i.length) {\n            i = i[0];\n            var d = (i.contentWindow || i.contentDocument);\n            if (d.document) {\n                d = d.document;\n            }\n            if (d.body && d.body.isContentEditable) {\n                return d.body;\n            }\n        }\n        // search for disabled text editor\n        var editable = $(response).find(\"textarea\");\n        if (editable.length) {\n            return editable.get(0);\n        }\n        // shouldn't happen !!\n        return null;\n    };\n\n    JS.get_textarea = function(response) {\n        if ($(response).prop(\"tagName\")==\"TEXTAREA\") {\n            return response;\n        }\n        return $(response).find(\"textarea\").get(0);\n    };\n\n    JS.get_textarea_name = function(response) {\n        var textarea = JS.get_textarea(response);\n        return $(textarea).attr(\"name\");\n    };\n\n    JS.get_itemcount_id = function(response) {\n        var name = JS.get_textarea_name(response);\n        return \"id_\" + name + \"_itemcount\";\n    };\n\n    JS.escaped_id = function(id) {\n        var regexp = new RegExp(\"(:|\\\\.|\\\\[|\\\\]|,|=|@)\", \"g\");\n        return \"#\" + id.replace(regexp, \"\\\\$1\");\n    };\n\n    JS.show_itemcount = function(response, id) {\n\n        var tagname = $(response).prop(\"tagName\");\n        var text = (tagname==\"TEXTAREA\" ? $(response).val() : $(response).text());\n        var itemcount = text.split(JS.itemsplit).filter(function(item) {\n            return (item !== '');\n        }).length;\n\n        // fetch descriptor string\n        id = JS.escaped_id(id);\n        $(id + \" .countitems .value\").text(itemcount);\n\n        if (JS.itemtype == \"words\") {\n            var warningtext = \"\";\n\n            if (itemcount) {\n                if (JS.minitems && JS.minitems > itemcount) {\n                    warningtext = JS.str[\"min\" + JS.itemtype + \"warning\"];\n                }\n                if (JS.maxitems && JS.maxitems < itemcount) {\n                    warningtext = JS.str[\"max\" + JS.itemtype + \"warning\"];\n                }\n            }\n\n            var elm = document.querySelector(id + \" .countitems .warning\");\n            if (elm) {\n                elm.innerText = warningtext;\n                if (warningtext == \"\") {\n                    elm.classList.add(\"d-none\");\n                } else {\n                    elm.classList.remove(\"d-none\");\n                }\n            }\n        }\n    };\n\n    JS.setup_responsesample = function(txt) {\n        if (txt==\"\") {\n            return;\n        }\n        JS.responsesample = txt;\n        STR.get_strings([\n            {\"key\": \"hidesample\", \"component\": JS.plugin},\n            {\"key\": \"showsample\", \"component\": JS.plugin}\n        ]).done(function(s) {\n            var i = 0;\n            JS.str.hidesample = s[i++];\n            JS.str.showsample = s[i++];\n            var last = $(\".qtext\").find(\"p:not(:empty), div:not(:empty)\");\n            if (last.length) {\n                last = last.last();\n            } else {\n                last = $(\".qtext\");\n            }\n\n            last.append($(\"<span></span>\").click(function(){\n                var newtxt = \"\",\n                    oldtxt = \"\",\n                    saveresponse = false;\n                if ($(this).hasClass(\"showsample\")) {\n                    $(this).removeClass(\"showsample\")\n                           .addClass(\"hidesample\")\n                           .text(JS.str.hidesample);\n                    newtxt = JS.responsesample;\n                    saveresponse = true;\n                } else {\n                    $(this).removeClass(\"hidesample\")\n                           .addClass(\"showsample\")\n                           .text(JS.str.showsample);\n                    newtxt = JS.responseoriginal;\n                }\n\n                // Locate response element\n                var editor = null;\n                var qtext = $(this).closest(\".qtext\");\n                if (JS.editortype==\"audio\" || JS.editortype==\"video\") {\n                    editor = qtext.find(\".audiovideo_response_prompt\");\n                } else {\n                    var r = qtext.next(\".ablock\").find(\".answer .qtype_essay_response\");\n                    if (r.is(\"[name$='_answer']\")) {\n                        // Plain text (i.e. no editor)\n                        editor = r;\n                    } else {\n                        // Atto\n                        editor = r.find(\"[contenteditable=true]\");\n                        if (editor.length==0) {\n                            // TinyMCE\n                            editor = r.find(\"iframe\").contents().find(\"[contenteditable=true]\");\n                            if (editor.length==0) {\n                                // Plain text editor\n                                editor = r.find(\"[name$='_answer']\");\n                            }\n                        }\n                    }\n                }\n\n                if (editor===null || editor.length==0) {\n                    return false; // shouldn't happen !!\n                }\n\n                if (editor.prop(\"tagName\")==\"TEXTAREA\") {\n                    oldtxt = editor.val();\n                    editor.val(newtxt).keyup();\n                } else {\n                    oldtxt = editor.text();\n                    editor.text(newtxt).keyup();\n                }\n\n                if (saveresponse) {\n                    JS.responseoriginal = oldtxt;\n                }\n                return true;\n            }).trigger(\"click\"));\n        });\n    };\n\n    return JS;\n});\n\n"],"names":["define","$","STR","JS","readonly","itemtype","minitems","maxitems","editortype","responsesample","itemsplit","RegExp","setup_read_only_files","setup_response_heights","setup_itemcounts","setup_responsesample","get_strings","plugin","done","s","i","str","rotate","scale","overflow","auto","hidden","visible","actions","crop","reset","save","document","querySelectorAll","forEach","img","dataset","buttons_added","classList","add","container","createElement","parentNode","insertBefore","appendChild","style","transitionDuration","complete","set_image_dimensions","onload","this","buttonsets","type","label","buttonset","Array","values","value","txt","push","create_button","transform_image","create_buttonset","nextElementSibling","width","offsetWidth","height","offsetHeight","offset","ratio","position","setAttribute","addEventListener","image_dragstart","image_drag","image_dragend","evt","evtPageY","pageY","evtPageX","pageX","imgOffsetTop","offsetTop","imgOffsetLeft","offsetLeft","offsetY","offsetX","parseInt","top","left","preventDefault","stopPropagation","buttons","span","createTextNode","fn","button","name","matches","deselect_button","select_button","previousElementSibling","querySelector","set_default_button","rotate_angle","scale_factor","t","transform","replace","trim","maxWidth","h","remove","each","scrollHeight","maxwordswarning","minwordswarning","id","get_itemcount_id","editorloaded","Deferred","check_editor","when","proxy","setup_itemcount","response","selector","resolve","editorchecker","setInterval","find","length","clearInterval","editorinterval","editable","get_editable_element","keyup","show_itemcount","prop","get","getElementsByTagName","d","contentWindow","contentDocument","body","isContentEditable","textarea","get_textarea","attr","get_textarea_name","regexp","itemcount","val","text","split","filter","item","escaped_id","warningtext","elm","innerText","hidesample","showsample","last","append","click","newtxt","oldtxt","saveresponse","hasClass","removeClass","addClass","responseoriginal","editor","qtext","closest","r","next","is","contents","trigger"],"mappings":"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"}